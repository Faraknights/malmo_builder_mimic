(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{1492:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[gameMode]/[environmentMode]",function(){return n(8882)}])},8882:function(e,t,n){"use strict";n.r(t),n.d(t,{__N_SSG:function(){return eq},default:function(){return eQ}});var a,s,i,r,o,l,c,h,d,p,m,u,x,E,g,C,j,y,O,I,A,N,f,L,S,T,P,v=n(5893),M=n(7294);function R(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}function w(e,t){for(let n of e)for(let e of t)if(R(n,e))return!0;return!1}function b(e,t){let n=(e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z});return Array.isArray(e)?e.map(e=>n(e,t)):n(e,t)}(a=x||(x={})).MINECRAFT="MINECRAFT",a.COCOBOTS="COCOBOTS";var B=n(9477);(s=E||(E={})).RED="RED",s.BLUE="BLUE",s.GREEN="GREEN",s.ORANGE="ORANGE",s.PURPLE="PURPLE",s.YELLOW="YELLOW",s.WHITE="WHITE",s.BLACK="BLACK",s.NEW="NEW";let _={[E.RED]:{hex:"#ff0000",id:E.RED},[E.BLUE]:{hex:"#1b4ccd",id:E.BLUE},[E.GREEN]:{hex:"#008000",id:E.GREEN},[E.ORANGE]:{hex:"#ff6600",id:E.ORANGE},[E.PURPLE]:{hex:"#ac00e6",id:E.PURPLE},[E.YELLOW]:{hex:"#ffa500",id:E.YELLOW},[E.WHITE]:{hex:"#ffffff",id:E.WHITE},[E.BLACK]:{hex:"#000000",id:E.BLACK},[E.NEW]:{hex:"#deefe1",id:E.NEW}};var H=n(463),D=n(398),z=n(9119);(i=g||(g={})).CELL_BOARD="CELL_BOARD",i.SHAPE="SHAPE",i.SHAPE_FACE="SHAPE_FACE",i.GROUP="GROUP",i.NON_CLICKABLE_FACE="NON_CLICKABLE_FACE",i.SCENE="SCENE",(r=C||(C={})).FRONT="FRONT",r.BACK="BACK",r.TOP="TOP",r.BOTTOM="BOTTOM",r.LEFT="LEFT",r.RIGHT="RIGHT";let U={[C.FRONT]:{translation:new B.Vector3(0,0,.5),rotation:new B.Euler(0,0,0)},[C.BACK]:{translation:new B.Vector3(0,0,-.5),rotation:new B.Euler(0,Math.PI,0)},[C.TOP]:{translation:new B.Vector3(0,.5,0),rotation:new B.Euler(-Math.PI/2,0,0)},[C.BOTTOM]:{translation:new B.Vector3(0,-.5,0),rotation:new B.Euler(Math.PI/2,0,0)},[C.LEFT]:{translation:new B.Vector3(.5,0,0),rotation:new B.Euler(0,Math.PI/2,0)},[C.RIGHT]:{translation:new B.Vector3(-.5,0,0),rotation:new B.Euler(0,-Math.PI/2,0)}},F=e=>{let t=U[e.facingDirection];return(0,v.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:{type:g.SHAPE_FACE,faceDirection:e.facingDirection},children:[(0,v.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,v.jsx)(z.w,{linewidth:1,threshold:15,color:e.color}),(0,v.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};(o=j||(j={}))[o.CUBE=0]="CUBE",o[o.SCREW=1]="SCREW",o[o.NUT=2]="NUT",o[o.WASHER=3]="WASHER",o[o.HORIZONTAL_BRIDGE=4]="HORIZONTAL_BRIDGE",o[o.VERTICAL_BRIDGE=5]="VERTICAL_BRIDGE",o[o.HORIZONTAL_BRIDGE_COMPONENT=6]="HORIZONTAL_BRIDGE_COMPONENT",o[o.VERTICAL_BRIDGE_COMPONENT=7]="VERTICAL_BRIDGE_COMPONENT";var G=n(7632);class k{constructor(e,t,n,a){this.nbObjects=()=>{let e=0;for(let t of this.shapes)t instanceof k?e+=t.nbObjects():e++;return e},this.objectExists=(e,t,n)=>{for(let a of this.shapes)if(a instanceof k){if(a.objectExists(e-this.startingPoint.x,t-this.startingPoint.y,n-this.startingPoint.z))return!0}else if(e===a.position.x+this.startingPoint.x&&t===a.position.y+this.startingPoint.y&&n===a.position.z+this.startingPoint.z)return!0;return!1},this.getPositions=()=>this.shapes.flatMap(e=>e instanceof k?e.getPositions():b(Y[e.shape],e.position)),this.startingPoint=e,this.shapes=t.map(e=>({...e,breakable:!!a})),this.uuid=(0,G.Z)(),this.pending=n,this.breakable=!!a}}let W=e=>{let{shapeGroup:t}=e;return(0,v.jsx)("mesh",{userData:{type:g.GROUP,position:t.startingPoint,pending:t.pending},children:t.shapes.map((e,n)=>e instanceof k?(0,v.jsx)(W,{shapeGroup:{...e,breakable:t.breakable}},`group-${n}`):(0,v.jsx)(J,{...e,breakable:t.breakable},`shape-${n}`))})},V={[C.FRONT]:{translation:new B.Vector3(0,0,.5),rotation:new B.Euler(0,0,0),type:g.NON_CLICKABLE_FACE},[C.BACK]:{translation:new B.Vector3(0,0,-.5),rotation:new B.Euler(0,Math.PI,0),type:g.NON_CLICKABLE_FACE},[C.TOP]:{translation:new B.Vector3(0,.5,0),rotation:new B.Euler(-Math.PI/2,0,0),type:g.SHAPE_FACE},[C.BOTTOM]:{translation:new B.Vector3(0,-.5,0),rotation:new B.Euler(Math.PI/2,0,0),type:g.SHAPE_FACE},[C.LEFT]:{translation:new B.Vector3(.5,0,0),rotation:new B.Euler(0,Math.PI/2,0),type:g.NON_CLICKABLE_FACE},[C.RIGHT]:{translation:new B.Vector3(-.5,0,0),rotation:new B.Euler(0,-Math.PI/2,0),type:g.NON_CLICKABLE_FACE}},K=e=>{let t=V[e.facingDirection];return(0,v.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:t.type===g.SHAPE_FACE?{type:g.SHAPE_FACE,faceDirection:e.facingDirection}:{type:g.NON_CLICKABLE_FACE},children:[(0,v.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,v.jsx)(z.w,{linewidth:1,threshold:15,color:e.color}),(0,v.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};var $=e=>{let{pending:t,color:n,rotation:a}=e,s=new B.Color(n.hex);return(0,v.jsx)("mesh",{scale:["HORIZONTAL"===a?1:.6,1,"HORIZONTAL"===a?.6:1],children:Object.entries(C).map(e=>{let[n,a]=e;return(0,v.jsx)(K,{color:s,opacity:t?eK:1,facingDirection:a},n)})})};let Z={[j.CUBE]:e=>{let{pending:t,color:n}=e,a=new B.Color(n.hex);return(0,v.jsx)(v.Fragment,{children:Object.entries(C).map(e=>{let[n,s]=e;return(0,v.jsx)(F,{color:a,opacity:t?eK:1,facingDirection:s},n)})})},[j.SCREW]:function(e){let{pending:t,position:n,color:a}=e,s=new B.LineCurve3(new B.Vector3(0,-.5,0),new B.Vector3(0,.5,0)),i=new B.Color(a.hex),r=t?eK:1,o=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:i,side:B.FrontSide,transparent:1!==r,opacity:r});return(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE},scale:[.65,1,.65],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,25]}),o]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,25]}),o]}),(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE,position:n,pending:t},children:[(0,v.jsx)("tubeGeometry",{args:[s,1,.5,25,!1]}),1===r&&(0,v.jsx)(z.w,{linewidth:1,color:i.clone().addScalar(.2)}),o]})]})},[j.NUT]:function(e){let{pending:t,position:n,color:a}=e,s=new B.LineCurve3(new B.Vector3(0,-.5,0),new B.Vector3(0,.5,0)),i=new B.Color(a.hex),r=t?eK:1,o=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:i,side:B.FrontSide,transparent:1!==r,opacity:r});return(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE},scale:[1.1,1,1.1],rotation:[0,-Math.PI/4,0],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),o]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),o]}),(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE,position:n,pending:t},children:[(0,v.jsx)("tubeGeometry",{args:[s,1,.5,4,!1]}),1===r&&(0,v.jsx)(z.w,{linewidth:1,color:i.clone().addScalar(.2)}),o]})]})},[j.HORIZONTAL_BRIDGE]:e=>{let{color:t,pending:n,position:a,breakable:s}=e,i=new k(a,[{color:t,pending:n,position:{x:0,y:0,z:0},shape:j.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,G.Z)()},{color:t,pending:n,position:{x:1,y:0,z:0},shape:j.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,G.Z)()}],n,s);return(0,v.jsx)(W,{shapeGroup:i})},[j.VERTICAL_BRIDGE]:e=>{let{color:t,pending:n,position:a,breakable:s}=e,i=new k(a,[{color:t,pending:n,position:{x:0,y:0,z:0},shape:j.VERTICAL_BRIDGE_COMPONENT,uuid:(0,G.Z)()},{color:t,pending:n,position:{x:0,y:0,z:1},shape:j.VERTICAL_BRIDGE_COMPONENT,uuid:(0,G.Z)()}],n,s);return(0,v.jsx)(W,{shapeGroup:i})},[j.WASHER]:function(e){let{pending:t,color:n}=e,a=new B.LineCurve3(new B.Vector3(0,-.5,0),new B.Vector3(0,.5,0)),s=new B.Color(n.hex),i=t?eK:1,r=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:s,side:B.FrontSide,transparent:1!==i,opacity:i});return(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE},scale:[.95,1,.95],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),r,1===i&&(0,v.jsx)(z.w,{linewidth:1,color:s.clone().addScalar(.2)})]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:g.SHAPE_FACE,faceDirection:C.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),r,1===i&&(0,v.jsx)(z.w,{linewidth:1,color:s.clone().addScalar(.2)})]}),(0,v.jsxs)("mesh",{userData:{type:g.NON_CLICKABLE_FACE},children:[(0,v.jsx)("tubeGeometry",{args:[a,1,.5,4,!1]}),1===i&&(0,v.jsx)(z.w,{linewidth:1,color:s.clone().addScalar(.2)}),r]})]})},[j.HORIZONTAL_BRIDGE_COMPONENT]:e=>(0,v.jsx)($,{...e,rotation:"HORIZONTAL"}),[j.VERTICAL_BRIDGE_COMPONENT]:e=>(0,v.jsx)($,{...e,rotation:"VERTICAL"})},Y={[j.CUBE]:[{x:0,y:0,z:0}],[j.SCREW]:[{x:0,y:0,z:0}],[j.NUT]:[{x:0,y:0,z:0}],[j.HORIZONTAL_BRIDGE]:[{x:0,y:0,z:0},{x:1,y:0,z:0}],[j.VERTICAL_BRIDGE]:[{x:0,y:0,z:0},{x:0,y:0,z:1}],[j.WASHER]:[{x:0,y:0,z:0}],[j.HORIZONTAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}],[j.VERTICAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}]},X=(e,t,n)=>{let a=e=>[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)],s=a(e),i=a(t);return"#"+s.map((e,t)=>Math.max(0,Math.min(255,Math.round(e+(i[t]-e)*n/100)))).map(e=>e.toString(16).padStart(2,"0")).join("")},J=e=>{let t=Z[e.shape];return(0,v.jsx)("mesh",{userData:{type:g.SHAPE,position:e.position,pending:e.pending,shape:e.shape},position:[e.position.x,e.position.y,e.position.z],children:e.breakable&&(0,v.jsx)(t,{...e,color:{hex:X(e.color.hex,_.WHITE.hex,40),id:_.WHITE.id}})||(0,v.jsx)(t,{...e})})};(l=y||(y={})).SIMULATION="SIMULATION",l.VISUALIZATION="VISUALIZATION",l.NEBULA="NEBULA";var q=n(2473);let Q=e=>{let{position:t}=e;return(0,v.jsxs)("mesh",{userData:{type:g.CELL_BOARD,position:t},rotation:[-Math.PI/2,0,0],position:[t.x,.5,t.z],children:[(0,v.jsx)("planeGeometry",{args:[1,1]}),(0,v.jsx)(z.w,{linewidth:1,threshold:15,color:"black"}),(0,v.jsx)("meshStandardMaterial",{color:[e$.r,e$.g,e$.b],side:B.FrontSide})]})};var ee=e=>{let{environmentMode:t}=e,n=eH[t];return(0,v.jsxs)(v.Fragment,{children:[Array.from({length:n.x.max-n.x.min+1},(e,t)=>n.x.min+t).map(e=>(0,v.jsx)(M.Fragment,{children:Array.from({length:n.z.max-n.z.min+1},(e,t)=>n.z.min+t).map(t=>(0,v.jsx)(Q,{position:{x:e,y:0,z:t}},`${e},${t}`))},e)),(0,v.jsx)(q.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,0],position:[(n.x.max+n.x.min)/2,.5,n.z.min-2],color:"white",anchorX:"center",anchorY:"middle",children:"N"}),(0,v.jsx)(q.x,{scale:[1,1,1],rotation:[Math.PI/2,0,0],position:[n.x.max+2,.5,(n.z.max+n.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"E"}),(0,v.jsx)(q.x,{scale:[1,1,1],rotation:[Math.PI/2,0,Math.PI],position:[n.x.min-2,.5,(n.z.max+n.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"W"}),(0,v.jsx)(q.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,Math.PI],position:[(n.x.max+n.x.min)/2,.5,n.z.max+2],color:"white",anchorX:"center",anchorY:"middle",children:"S"})]})};(c=O||(O={})).PLACE="PLACE",c.BREAK="REMOVE";let et={[C.FRONT]:{x:0,y:0,z:1},[C.BACK]:{x:0,y:0,z:-1},[C.TOP]:{x:0,y:1,z:0},[C.BOTTOM]:{x:0,y:-1,z:0},[C.LEFT]:{x:1,y:0,z:0},[C.RIGHT]:{x:-1,y:0,z:0}},en=()=>{let[e,t]=(0,M.useState)([]),[n,a]=(0,M.useState)(),s=e=>{t(t=>[...t,e])};return{objects:e,pending:n,setObjects:t,setPending:a,nbObjects:()=>{let t=0;for(let n of e)n instanceof k?t+=n.nbObjects():t++;return t},objectExists:(t,n,a)=>{for(let s of e)if(s instanceof k){if(s.objectExists(t,n,a))return!0}else if(t===s.position.x&&n===s.position.y&&a===s.position.z)return!0;return!1},addObject:s,removeObject:(e,n,a)=>{t(t=>t.filter(t=>{if(t instanceof k){if(t.objectExists(e,n,a))return!1}else if(t.position.x===e&&t.position.y===n&&t.position.z===a)return!1;return!0}))},clear:()=>{t([])},confirmPending:e=>{n&&s({...n,pending:!1}),a(e)},setBreaking:e=>{let n=e=>e.breakable?e:{...e,breakable:!0};t(t=>t.map(t=>t instanceof k&&R(t.startingPoint,e)?n(t):"position"in t&&R(t.position,e)?n(t):t))},removeBreaking:()=>{let e=e=>({...e,breakable:!1});t(t=>t.map(t=>t.breakable?e(t):t))},getPosition:()=>e.flatMap(e=>b(Y[e.shape],e.position))}},ea=(e,t)=>{let[n,a]=(0,M.useState)(e[0]),[s,i]=(0,M.useState)(e),[r,o]=(0,M.useState)(t[0]),[l,c]=(0,M.useState)(t);return{currentColor:n,colors:s,currentShape:r,shapes:l,setCurrentColor:a,setColors:i,setCurrentShape:o,setShapes:c,changeColor:e=>{a(_[e])}}},es=()=>{let[e,t]=(0,M.useState)([]);return{chatHistory:e,setChatHistory:t,addMessage:e=>{e.content&&t(t=>[...t,e])},clear:()=>{t([])}}};class ei{constructor(){this.gameLog=[{chatHistory:[],shapeInPlace:[],timestamp:new Date}]}getLength(){return this.gameLog.length}addWorldState(e){this.gameLog.push(e)}clear(){this.gameLog=[]}getLastWorldState(){let e=this.gameLog[this.gameLog.length-1];return e?e.timestamp?{timestamp:e.timestamp,chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:{chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:void 0}getWorldStateById(e){if(e<this.gameLog.length){let t=this.gameLog[e];return t.timestamp?{timestamp:t.timestamp,chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}:{chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}}}}let er=(0,M.createContext)(void 0),eo=e=>{let{children:t,initialEnvironmentMode:n,initialGameMode:a}=e,[s,i]=(0,M.useState)(n),[r,o]=(0,M.useState)(a),[l,c]=(0,M.useState)(eW[a]),[h,d]=(0,M.useState)(new ei),[p,m]=(0,M.useState)(ek[n]),u=en(),x=es(),E=ea(eB[n],e_[n]),[g,C]=(0,M.useState)(void 0),j=()=>{c(eW[r]),d(new ei),u.clear(),x.setChatHistory([]),E.setColors(eB[s]),E.setCurrentColor(eB[s][0]),E.setShapes(e_[s]),E.setCurrentShape(e_[s][0]),m(ek[s]),C(void 0)};return(0,M.useEffect)(j,[s,r]),(0,M.useEffect)(()=>{let e=h.getLastWorldState();e?(u.objects.length!==e.shapeInPlace.length||x.chatHistory.length!==e.chatHistory.length)&&(h.addWorldState({timestamp:new Date,chatHistory:[...x.chatHistory],shapeInPlace:[...u.objects]}),d(h)):(0!==u.objects.length||0!==x.chatHistory.length)&&(h.addWorldState({timestamp:new Date,chatHistory:[...x.chatHistory],shapeInPlace:[...u.objects]}),d(h))},[u.objects,x.chatHistory]),(0,v.jsx)(er.Provider,{value:{environmentMode:{environmentMode:s,setEnvironmentMode:i},gameMode:{gameMode:r,setGameMode:o},action:{action:l,setAction:c},pointer:{pointer:g,setPointer:C},gameLog:{gameLog:h,setGameLog:d},camera:{camera:p,setCamera:m},shapeInPlace:u,inventory:E,chat:x,clear:j},children:t})},el=()=>{let e=(0,M.useContext)(er);if(void 0===e)throw Error("useGlobalState must be used within a GlobalStateProvider");return e};function ec(e){if(e.userData.type===g.SHAPE||e.userData.type!==g.NON_CLICKABLE_FACE&&e.userData.type!==g.SHAPE_FACE)return e;{let t=e;for(;t.userData.type!==g.SHAPE;)t.parent&&(t=t.parent);return t}}function eh(e){let t={x:0,y:0,z:0};e.userData.type===g.SHAPE?t=b(t,e.userData.position):e.userData.type===g.GROUP&&(t=b(t,e.userData.position));let n=e.parent;return n.userData.type===g.GROUP?b(t,eh(n)):t}var ed=()=>{let{gameMode:{gameMode:e},environmentMode:{environmentMode:t},pointer:{setPointer:n},shapeInPlace:a,inventory:s,action:i}=el(),{objects:r,pending:o}=a,[l,c]=(0,M.useState)(null),h=(e,n,i)=>{let r={uuid:(0,G.Z)(),pending:!0,breakable:!1,color:s.currentColor,position:e,shape:n};return eU[t](r,b(Y[r.shape],r.position),a.getPosition(),i)},d=e=>{let t=e.intersections[0].object,n=ec(t);if(t.userData.type===g.SHAPE_FACE){let e=t.userData,i=b(eh(n),et[e.faceDirection]);a.confirmPending(h(i,s.currentShape,!0))}else a.confirmPending();e.stopPropagation()},p=e=>{if(e.intersections[0]){let t=ec(e.intersections[0].object);if(t.userData.type===g.SHAPE){for(;t.parent?.userData.type===g.GROUP;)t=t.parent;let e=eh(t);a.removeObject(e.x,e.y,e.z)}u(e.intersections.slice(1))}e.stopPropagation()},m=e=>{if(e[0]){let t=e[0].object;if(t.userData.type===g.CELL_BOARD){let e=t.userData,n=a.pending,i={...e.position,y:e.position.y+1};n&&R(n instanceof k?n.startingPoint:n.position,i)||a.setPending(h(i,s.currentShape))}else if(t.userData.type===g.SHAPE_FACE){let e=t.userData,n=ec(t);if(!(n?.userData).pending){let t=a.pending,i=b(eh(n),et[e.faceDirection]);t&&w([t instanceof k?t.startingPoint:t.position],[i])||a.setPending(h(i,s.currentShape))}}else a.setPending(void 0)}},u=e=>{if(e[0]){a.removeBreaking();let t=ec(e[0].object);if(t.userData.type===g.SHAPE){for(;t.parent?.userData.type===g.GROUP;)t=t.parent;let e=eh(t);n&&n({cartesianCoordinate:e,type:g.SHAPE}),a.setBreaking(e)}else if(t.userData.type===g.CELL_BOARD){let e=t.userData;n&&n({cartesianCoordinate:e.position,type:g.CELL_BOARD})}}},x=(0,M.useMemo)(()=>r.map(e=>e instanceof k?(0,v.jsx)(W,{shapeGroup:{...e}},e.uuid):(0,v.jsx)(J,{...e},e.uuid)),[r]),E=(0,M.useMemo)(()=>o&&e===y.SIMULATION&&(o instanceof k?(0,v.jsx)(W,{shapeGroup:o},o.uuid):(0,v.jsx)(J,{...o},o.uuid)),[o,e]);return(0,v.jsxs)("mesh",{onPointerDown:e=>c({x:e.clientX,y:e.clientY}),onPointerMove:e=>{let t=e.intersections.filter(e=>{let t=ec(e.object);return t.userData.type!==g.SHAPE||!t.userData.pending});i.action===O.PLACE?m(t):u(t)},onPointerOut:e=>{0===e.intersections.length&&(a.setPending(void 0),a.removeBreaking(),n&&n(void 0))},onPointerUp:t=>{if(l&&e===y.SIMULATION){let e=Math.abs(t.clientX-l.x),n=Math.abs(t.clientY-l.y);e<5&&n<5&&(i.action===O.PLACE?a.pending&&d(t):i.action===O.BREAK&&p(t))}c(null)},scale:[eb[t].x,eb[t].y,eb[t].z],userData:{type:g.SCENE},children:[(0,v.jsx)(ee,{environmentMode:t},t),x,E]})};(h=I||(I={})).FREE="Free camera",h.SIDE_VIEW="Side view",h.UPPER_VIEW="Upper view";let ep={[I.FREE]:{orthographic:!1,polarAngle:{max:Math.PI,min:0},cameraSettings:{fov:75,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e3,position:[0,5,10]}},[I.SIDE_VIEW]:{orthographic:!0,polarAngle:{max:Math.PI/2,min:Math.PI/2},cameraSettings:{zoom:50,position:[100,5,10]}},[I.UPPER_VIEW]:{orthographic:!0,polarAngle:{max:0,min:0},cameraSettings:{zoom:50,position:[0,5,10]},azimuthAngle:{max:0,min:0}}},em=()=>{let{environmentMode:{environmentMode:e}}=el(),t=eH[e];return(0,v.jsx)("mesh",{position:[-(t.x.max+t.x.min)/2,1,-(t.z.max+t.z.min)/2],children:(0,v.jsx)(ed,{})})};var eu=()=>{let e=new B.Color(1710878),{camera:t}=el().camera,n=(0,M.useMemo)(()=>(0,v.jsx)(em,{}),[]);return(0,v.jsxs)(H.Xz,{gl:{preserveDrawingBuffer:!0},frameloop:"demand",orthographic:ep[t].orthographic,camera:ep[t].cameraSettings,children:[n,(0,v.jsx)(D.z,{enablePan:!1,minPolarAngle:ep[t].polarAngle.min,maxPolarAngle:ep[t].polarAngle.max,minAzimuthAngle:ep[t].azimuthAngle?.min,maxAzimuthAngle:ep[t].azimuthAngle?.max}),(0,v.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,v.jsx)("ambientLight",{intensity:1}),(0,v.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200}),(0,v.jsx)("color",{attach:"background",args:[e.r,e.g,e.b]})]},t)},ex=e=>{let{children:t}=e;return(0,v.jsx)("div",{id:"side",children:t})},eE=()=>{let{currentColor:e,colors:t,changeColor:n}=el().inventory,a=[];for(let e=0;e<t.length;e+=4)a.push(t.slice(e,e+4));return(0,v.jsxs)("div",{id:"colorPicker",className:"module",children:[(0,v.jsx)("h3",{children:"Color Picker"}),(0,v.jsx)("div",{id:"colorList",children:a.map((t,a)=>(0,v.jsx)("div",{children:t.map(t=>(0,v.jsx)("div",{className:`realisticButton color${e.id===t.id?" selected":""}`,style:{backgroundColor:t.hex},onClick:()=>n(t.id),children:(0,v.jsx)("span",{children:t.id[0]+t.id.slice(1).toLowerCase()})},t.id))},a))})]})},eg=()=>{let{action:e,setAction:t}=el().action;return(0,v.jsxs)("div",{id:"actionSelector",className:"module",children:[(0,v.jsx)("h3",{children:"Action:"}),(0,v.jsx)("div",{className:"buttonsWrapper",children:Object.values(O).map(n=>(0,v.jsx)("button",{className:`realisticButton ${n}${e===n?" selected":""}`,onClick:()=>t(n),children:n[0]+n.slice(1).toLowerCase()},n))})]})},eC=()=>{let{inventory:{currentColor:e,currentShape:t,shapes:n,setCurrentShape:a},environmentMode:{environmentMode:s}}=el(),i=[];for(let e=0;e<n.length;e+=2)i.push(n.slice(e,e+2));return n.length>1&&(0,v.jsxs)("div",{id:"shapePicker",className:"module",children:[(0,v.jsx)("h3",{children:"Shape Picker"}),(0,v.jsx)("div",{id:"colorList",children:i.map((n,i)=>(0,v.jsx)("div",{children:n.map(n=>{let i=Y[n],r=i.map(e=>e.x),o=i.map(e=>e.z);return(0,v.jsxs)("div",{className:`color${t===n?" selected":""}`,onClick:()=>a(n),children:[(0,v.jsxs)(H.Xz,{frameloop:"demand",camera:{position:[0,2,0],far:1e3},children:[(0,v.jsx)("mesh",{scale:[eb[s].x,eb[s].y,eb[s].z],position:[-((Math.max(...r)-Math.min(...r))/2),0,-((Math.max(...o)-Math.min(...o))/2)],children:(0,v.jsx)(J,{breakable:!1,pending:!1,color:e,position:{x:0,y:0,z:0},shape:n,uuid:j[n]})}),(0,v.jsx)(D.z,{}),(0,v.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,v.jsx)("ambientLight",{intensity:1}),(0,v.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200})]}),(0,v.jsx)("span",{children:j[n][0]+j[n].slice(1).toLowerCase().replace("_"," ")})]},n)})},i))})]})||(0,v.jsx)(v.Fragment,{})},ej=n(1375);(d=A||(A={})).SYSTEM="SYSTEM",d.ARCHITECT="ARCHITECT",d.BUILDER="BUILDER",d.NEBULA="NEBULA",d.UNKNOWN="UNKNOWN";let ey={[A.ARCHITECT]:"/assets/icons/Users/architect.png",[A.BUILDER]:"/assets/icons/Users/builder.png",[A.SYSTEM]:"/assets/icons/Users/settings.png",[A.NEBULA]:"/assets/icons/Users/robot.png",[A.UNKNOWN]:"/assets/icons/Users/unknown.png"},eO={[x.COCOBOTS]:"/assets/icons/environmentMode/cocobots.png",[x.MINECRAFT]:"/assets/icons/environmentMode/minecraft.png"};(p=N||(N={})).PLACEMENT="Shapes placed.",p.WAIT="Please Wait",p.WRONG_FILE_EXTENSION="The extension file is incorrect.";var eI=e=>{let{availableUsers:t}=e,n=(0,M.useRef)(null),{chat:a,gameMode:{gameMode:s},environmentMode:{environmentMode:i},shapeInPlace:r}=el();(0,M.useEffect)(()=>{n.current&&(n.current.scrollTop=n.current.scrollHeight)},[a.chatHistory]);let[o,l]=(0,M.useState)(A.ARCHITECT),[c,h]=(0,M.useState)(!1),[d,p]=(0,M.useState)(!1);return(0,v.jsxs)("div",{id:"chat",className:"module",children:[(0,v.jsx)("h3",{children:"Chat"}),(0,v.jsx)("hr",{}),(0,v.jsx)("div",{className:"historyMessages",ref:n,children:a.chatHistory.map((e,t)=>(0,v.jsxs)("div",{children:[(0===t||e.user!==a.chatHistory[t-1].user)&&(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{className:"userIcon",src:ey[e.user],alt:"userIcon"}),(0,v.jsx)("span",{className:"userName",children:e.user},`user-${t}`)]}),(0,v.jsx)("div",{className:`message${e.user===A.SYSTEM?" system":""}`,children:e.content},t)]},t))}),t.length>=1&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("hr",{}),(0,v.jsxs)("div",{className:"buttons",children:[(0,v.jsxs)("div",{className:"mainButtons",children:[(0,v.jsx)("button",{className:1!==t.length?"realisticButton":"alone",onClick:()=>{l(t[(t.findIndex(e=>e===o)+1)%t.length])},children:o}),(0,v.jsx)("input",{type:"text",className:c?"disable":"",disabled:c,placeholder:"writing here...",onKeyDown:e=>{if("Enter"===e.key){let t=e.currentTarget.value;a.addMessage({content:t,user:o}),e.currentTarget.value=""}}})]}),s===y.NEBULA&&(0,v.jsx)("button",{className:"realisticButton generate"+(c||0===(a.chatHistory.some(e=>e.user===A.SYSTEM&&e.content===N.PLACEMENT)?a.chatHistory.slice(a.chatHistory.reduceRight((e,t,n)=>-1===e&&t.user===A.SYSTEM&&t.content===N.PLACEMENT?n:e,-1)+1):a.chatHistory.filter(e=>e.user!==A.SYSTEM)).length?" disabled":""),onClick:()=>{p(!0);let e=(a.chatHistory.some(e=>e.user===A.SYSTEM&&e.content===N.PLACEMENT)?a.chatHistory.slice(a.chatHistory.reduceRight((e,t,n)=>-1===e&&t.user===A.SYSTEM&&t.content===N.PLACEMENT?n:e,-1)+1):a.chatHistory.filter(e=>e.user!==A.SYSTEM)).map(e=>e.content).join(". ");console.log(e),s===y.NEBULA&&(async()=>{let t=i===x.MINECRAFT?"/api/nebula_minecraft":"/api/nebula_cocobots";await (0,ej.L)(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e}),onmessage:async e=>{if(e.data){let t="";t=!function(e){if("string"!=typeof e)return!1;0===e.indexOf("data:")&&(e=e.split(",")[1]);try{return btoa(atob(e))===e}catch(e){return!1}}(e.data)?e.data:atob(e.data);try{let e=JSON.parse(t);if(console.log(e),"WAIT"===e.type)a.addMessage({content:e.content,user:A.SYSTEM}),h(!0),p(!1);else if("MESSAGE"===e.type){if(console.log(/^(place .*|pick) -?[0-9]+ -?[0-9]+ -?[0-9]+\n?$/gm.test(e.content)),/^(place .*|pick) -?[0-9]+ -?[0-9]+ -?[0-9]+\n?$/gm.test(e.content)){let t=e.content.trim().split("\n"),n=new ei;n.gameLog[0].shapeInPlace=r.objects,t.forEach(e=>{!function(e,t,n){let a=e.trim(),s=t.getLastWorldState();if(a.startsWith("place")){let e=a.split(" ");n===x.MINECRAFT?s?.shapeInPlace.push({pending:!1,breakable:!1,uuid:G.Z(),color:_[e[1].toUpperCase()],position:{x:parseInt(e[2]),y:parseInt(e[3]),z:parseInt(e[4])},shape:j.CUBE}):n===x.COCOBOTS&&s?.shapeInPlace.push({pending:!1,breakable:!1,uuid:G.Z(),color:_[e[2].toUpperCase()],position:{x:parseInt(e[3]),y:parseInt(e[4]),z:parseInt(e[5])},shape:j[e[1].toUpperCase()]})}else if(a.startsWith("pick")){let e=a.split(" "),t={x:parseInt(e[1]),y:parseInt(e[2]),z:parseInt(e[3])};s.shapeInPlace=s.shapeInPlace.filter(e=>e.position.x!==t.x||e.position.y!==t.y||e.position.z!==t.z)}else{let e=a.split(/<(.*)> (.*)/);e[1]&&e[2]&&s?.chatHistory.push({user:A[e[1].toUpperCase()],content:e[2]})}t.addWorldState(s)}(e.trim(),n,i)}),console.log(n),async function(e){for(let t=1;t<e.gameLog.length;t++){let n=e.gameLog[t];r.setObjects(n.shapeInPlace),await new Promise(e=>setTimeout(e,200))}a.addMessage({user:A.SYSTEM,content:N.PLACEMENT})}(n)}else a.addMessage({content:e.content,user:A.NEBULA});h(!1)}}catch(e){console.error("Failed to parse JSON:",e)}}}})})()},children:d?(0,v.jsx)("img",{src:"/assets/images/loading_colorful.gif",alt:"loading image"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Generate"}),(0,v.jsx)("svg",{version:"1.0",viewBox:"0 0 200 200",children:(0,v.jsxs)("g",{transform:"translate(0,200) scale(0.1,-0.1)",fill:"#000000",stroke:"none",children:[(0,v.jsx)("path",{d:"M1426 1808 c-9 -12 -16 -30 -16 -40 0 -9 -11 -48 -25 -85 -37 -103 -78 -134 -236 -177 -58 -16 -76 -37 -58 -68 5 -9 39 -23 76 -32 38 -10 90 -29 118 -44 59 -32 95 -90 121 -195 27 -110 80 -116 103 -10 18 82 57 159 94 187 27 21 88 44 197 75 28 8 39 44 20 66 -6 7 -27 16 -47 20 -60 11 -141 45 -174 72 -37 32 -63 81 -84 164 -9 35 -21 70 -27 77 -16 19 -45 14 -62 -10z"}),(0,v.jsx)("path",{d:"M791 1451 c-7 -5 -27 -60 -43 -122 -77 -293 -153 -370 -442 -449 -122 -33 -131 -37 -134 -61 -4 -34 10 -43 98 -64 115 -27 229 -71 287 -111 89 -61 152 -180 198 -374 21 -88 30 -102 64 -98 24 3 28 12 61 133 43 157 74 225 130 288 55 62 167 116 319 154 95 23 115 32 124 52 10 20 8 26 -12 42 -13 11 -31 19 -41 19 -34 0 -196 51 -267 84 -130 62 -194 154 -247 358 -40 148 -56 174 -95 149z"})]})})]})})]})]})]})},eA=()=>{let e=el().camera;return(0,v.jsx)("div",{id:"cameraSelector",className:"module",children:Object.values(I).map(t=>(0,v.jsx)("button",{className:`${t}${e.camera===t?" selected":""}`,onClick:()=>e.setCamera(t),children:t[0]+t.slice(1).toLowerCase()},t))})};function eN(){return(eN=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}var ef=e=>M.createElement("svg",eN({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,fill:"none",viewBox:"0 0 24 24"},e),f||(f=M.createElement("path",{fill:"#1C274C",d:"M12.554 16.506a.75.75 0 0 1-1.107 0l-4-4.375a.75.75 0 0 1 1.107-1.012l2.696 2.95V3a.75.75 0 0 1 1.5 0v11.068l2.697-2.95a.75.75 0 1 1 1.107 1.013z"})),L||(L=M.createElement("path",{fill:"#1C274C",d:"M3.75 15a.75.75 0 0 0-1.5 0v.055c0 1.367 0 2.47.117 3.337.12.9.38 1.658.981 2.26.602.602 1.36.86 2.26.982.867.116 1.97.116 3.337.116h6.11c1.367 0 2.47 0 3.337-.116.9-.122 1.658-.38 2.26-.982s.86-1.36.982-2.26c.116-.867.116-1.97.116-3.337V15a.75.75 0 0 0-1.5 0c0 1.435-.002 2.436-.103 3.192-.099.734-.28 1.122-.556 1.399-.277.277-.665.457-1.4.556-.755.101-1.756.103-3.191.103H9c-1.435 0-2.437-.002-3.192-.103-.734-.099-1.122-.28-1.399-.556-.277-.277-.457-.665-.556-1.4-.101-.755-.103-1.756-.103-3.191"})));function eL(){return(eL=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}var eS=e=>M.createElement("svg",eL({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,viewBox:"0 0 512 512"},e),S||(S=M.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M149.333 42.667v64h256v256h64v42.666h-64v64h-42.666v-64h-256V42.667zm59.67 232.64-59.67 63.782v23.578h213.334v-11.275l-45.568-45.557-38.773 38.791zm153.664-125.974H149.333V276.65L208 213.96l70.315 70.328 38.799-38.79 45.553 45.554zM288 170.667c17.673 0 32 14.327 32 32s-14.327 32-32 32-32-14.327-32-32 14.327-32 32-32m-181.333-64v42.666h-64v-42.666z"})));function eT(){return(eT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)({}).hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(null,arguments)}var eP=e=>M.createElement("svg",eT({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,fill:"none",viewBox:"0 0 24 24"},e),T||(T=M.createElement("path",{stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3v5m0 0h5M3 8l3-2.708A9 9 0 1 1 12 21a9 9 0 0 1-8.777-7"})));(m=P||(P={})).JSON="json",m.JSONL="jsonl",m.CSV="csv";let ev={[x.MINECRAFT]:{[P.CSV]:(e,t)=>{console.log(e,t)},[P.JSON]:(e,t)=>{console.log(e,t)}},[x.COCOBOTS]:{[P.CSV]:(e,t)=>{console.log(e,t)},[P.JSON]:(e,t)=>{console.log(e,t)},[P.JSONL]:(e,t)=>{console.log(e,t)}}},eM=M.memo(e=>{let{gameLog:t,currentIndex:n,currentgameId:a,onClick:s,searched:i}=e;return(0,v.jsxs)("div",{className:`game ${n===a?"selected":""} ${i?"searched":""}`,onClick:s,children:[!t.getWorldStateById(0)?.chatHistory.length&&!t.getWorldStateById(0)?.shapeInPlace.length&&(0,v.jsx)("div",{className:"new"})||(0,v.jsx)("div",{className:"old"}),(0,v.jsxs)("span",{children:["Game ",n]})]})});eM.displayName="GameComponent";var eR=()=>{let{environmentMode:{environmentMode:e},chat:t,shapeInPlace:n}=el(),[a,s]=(0,M.useState)([]),[i,r]=(0,M.useState)(0),[o,l]=(0,M.useState)(0),[c,h]=(0,M.useState)("");(0,M.useEffect)(()=>{s([])},[e]),(0,M.useEffect)(()=>{let e=a[i]?.gameLog.reduce((e,t,n,a)=>t.chatHistory.length!==(a[n-1]?.chatHistory.length??0)?n:e,0);e?l(e):l(0)},[i]),(0,M.useEffect)(()=>{if(a[i]){let e=a[i].getWorldStateById(o);e&&(n.setObjects(e.shapeInPlace),t.setChatHistory(e.chatHistory))}},[i,o]);let d=async n=>{let s=n.target.files&&n.target.files[0];if(s){let i=s.name.split(".").pop()?.toLowerCase(),r=void 0!==i&&Object.values(P).includes(i)?ev[e][i]:void 0;r?r(s,a):t.addMessage({user:A.SYSTEM,content:N.WRONG_FILE_EXTENSION}),n.target.value=""}};return(0,v.jsxs)("div",{id:"fileManager",className:"module",children:[(0,v.jsx)("label",{htmlFor:"gameFileInput",children:"Upload Game file"}),(0,v.jsx)("input",{id:"gameFileInput",type:"file",onChange:d}),(0,v.jsx)("hr",{}),(0,v.jsx)("div",{id:"games",children:a.map((e,t)=>(0,v.jsx)(eM,{gameLog:e,currentIndex:t,currentgameId:i,onClick:()=>{t!==i&&r(t)},searched:""!==c&&e.gameLog.some(e=>e.chatHistory.some(e=>e.content&&e.content.includes(c)))},t))}),a.length>=1&&(0,v.jsx)("input",{type:"text",className:"inputFinder",value:c,onChange:e=>{h(e.target.value)},placeholder:"text to search"}),(0,v.jsx)("hr",{}),(0,v.jsxs)("div",{id:"gameManager",className:a[i]?"":"disabled",children:[(0,v.jsx)("input",{type:"range",min:0,step:1,max:a[i]?a[i].getLength()-1:1,value:o,onChange:e=>{l(parseInt(e.target.value))}}),(0,v.jsxs)("div",{className:"buttonWrapper",children:[(0,v.jsx)("div",{className:`previousGame${a[i]&&0===i?" disabled":""}`,onClick:()=>{r(e=>e-1)}}),(0,v.jsx)("div",{className:`previousStep${a[i]&&0===o?" disabled":""}`,onClick:()=>{l(e=>e-1)}}),(0,v.jsx)("div",{className:`nextStep${a[i]&&o===a[i].getLength()-1?" disabled":""}`,onClick:()=>{l(e=>e+1)}}),(0,v.jsx)("div",{className:`nextGame${a[i]&&i===a.length-1?" disabled":""}`,onClick:()=>{r(e=>e+1)}})]})]})]})},ew=()=>{let{pointer:e}=el().pointer;return console.log(e),(0,v.jsx)(v.Fragment,{children:e&&(0,v.jsxs)("div",{className:"pointerIndicator",children:[(0,v.jsx)("span",{className:"type",children:e.type}),(0,v.jsxs)("span",{children:["x : ",e.cartesianCoordinate.x]}),(0,v.jsxs)("span",{children:["y : ",e.cartesianCoordinate.y]}),(0,v.jsxs)("span",{children:["z : ",e.cartesianCoordinate.z]})]})})};let eb={[x.MINECRAFT]:{x:1,y:1,z:1},[x.COCOBOTS]:{x:1,y:.3,z:1}},eB={[x.MINECRAFT]:[_[E.GREEN],_[E.BLUE],_[E.PURPLE],_[E.RED],_[E.ORANGE],_[E.YELLOW]],[x.COCOBOTS]:[_[E.GREEN],_[E.BLUE],_[E.RED],_[E.YELLOW]]},e_={[x.MINECRAFT]:[j.CUBE],[x.COCOBOTS]:[j.NUT,j.WASHER,j.SCREW,j.HORIZONTAL_BRIDGE,j.VERTICAL_BRIDGE]},eH={[x.MINECRAFT]:{x:{min:-5,max:5},y:{min:1,max:11},z:{min:-5,max:5}},[x.COCOBOTS]:{x:{min:0,max:7},y:{min:1,max:8},z:{min:0,max:7}}},eD=(e,t)=>e.every(e=>e.x>=t.x.min&&e.x<=t.x.max&&e.y>=t.y.min&&e.y<=t.y.max&&e.z>=t.z.min&&e.z<=t.z.max),ez=(e,t)=>1===e.y||t.some(t=>t.x===e.x&&t.y===e.y-1&&t.z===e.z),eU={[x.MINECRAFT]:(e,t,n)=>{if(!w(t,n)&&eD(t,eH[x.MINECRAFT]))return e},[x.COCOBOTS]:(e,t,n,a)=>{if(!w(t,n)&&eD(t,eH[x.COCOBOTS])&&(a||t.every(e=>ez(e,n))))return e}},eF={[x.MINECRAFT]:e=>({WorldStates:e.gameLog.map(e=>({Timestamp:e.timestamp,ChatHistory:e.chatHistory.map(e=>`<${e.user[0]}${e.user.slice(1).toLowerCase()}> ${e.content}`),BlocksInGrid:e.shapeInPlace.map(e=>({X:e.position.x,Y:e.position.y,Z:e.position.z,Type:"wool",Colour:e.color.id}))}))}),[x.COCOBOTS]:e=>({worldStates:e.gameLog.map(e=>({timestamp:e.timestamp,chatHistory:e.chatHistory.map(e=>`<${e.user[0]}${e.user.slice(1).toLowerCase()}> ${e.content}`),blocksInGrid:e.shapeInPlace.map(e=>({shape:`${Object.values(j)[e.shape][0]}${Object.values(j)[e.shape].slice(1).toLowerCase()}`,position:{x:e.position.x,y:e.position.y,z:e.position.z},color:`${e.color.id[0]}${e.color.id.slice(1).toLowerCase()}`}))}))})},eG={[x.MINECRAFT]:[y.SIMULATION,y.VISUALIZATION,y.NEBULA],[x.COCOBOTS]:[y.SIMULATION,y.VISUALIZATION,y.NEBULA]},ek={[x.MINECRAFT]:I.FREE,[x.COCOBOTS]:I.UPPER_VIEW},eW={[y.SIMULATION]:O.PLACE,[y.VISUALIZATION]:O.BREAK,[y.NEBULA]:O.BREAK},eV={[y.SIMULATION]:()=>{let{shapeInPlace:e,environmentMode:{environmentMode:t},gameLog:{gameLog:n},clear:a}=el();return(0,M.useEffect)(()=>{e.pending?document.body.style.cursor="pointer":document.body.style.cursor="auto"},[e]),(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(eA,{}),(0,v.jsx)(eu,{})]}),(0,v.jsxs)(ex,{children:[(0,v.jsx)(eg,{}),(0,v.jsx)(eE,{}),(0,v.jsx)(eC,{}),(0,v.jsx)(eI,{availableUsers:[A.ARCHITECT,A.BUILDER]}),(0,v.jsxs)("div",{id:"gameButtons",children:[(0,v.jsx)("button",{className:"realisticButton",onClick:()=>{let e=new Blob([JSON.stringify(eF[t](n))],{type:"application/json"}),a=URL.createObjectURL(e),s=document.createElement("a");s.href=a,s.download="gameLog.json",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)},children:(0,v.jsx)(ef,{})}),(0,v.jsx)("button",{className:"realisticButton",onClick:()=>{let e=document.querySelector('canvas[data-engine="three.js r164"]');if(e){let t=e.toDataURL("image/png"),n=document.createElement("a");n.href=t,n.download="canvas-image.png",document.body.appendChild(n),n.click(),document.body.removeChild(n)}else console.error("Canvas element not found")},children:(0,v.jsx)(eS,{})}),(0,v.jsx)("button",{className:"realisticButton warning",onClick:a,children:(0,v.jsx)(eP,{})})]})]})]})},[y.VISUALIZATION]:()=>(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(ew,{}),(0,v.jsx)(eu,{})]}),(0,v.jsxs)(ex,{children:[(0,v.jsx)(eR,{}),(0,v.jsx)(eI,{availableUsers:[]})]})]}),[y.NEBULA]:()=>(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(ew,{}),(0,v.jsx)(eA,{}),(0,v.jsx)(eu,{})]}),(0,v.jsx)(ex,{children:(0,v.jsx)(eI,{availableUsers:[A.ARCHITECT]})})]})},eK=.4,e$=new B.Color(11184810);var eZ=n(1163),eY=()=>{let{environmentMode:{environmentMode:e,setEnvironmentMode:t},gameMode:{gameMode:n,setGameMode:a}}=el(),s=(0,eZ.useRouter)();return(0,M.useEffect)(()=>{eG[e].includes(n)?s.push("/"+n.toLowerCase()+"/"+e.toLowerCase()):(a(eG[e][0]),s.push("/"+eG[e][0].toLowerCase()+"/"+e.toLowerCase()))},[e,n]),(0,v.jsxs)("header",{children:[(0,v.jsx)("nav",{id:"modeSelector",children:eG[e].map(e=>{let t=y[e];return(0,v.jsx)("div",{onClick:()=>a(t),className:n===t?"selected":"",children:t},t)})}),(0,v.jsxs)("button",{onClick:()=>{let n=Object.keys(x),a=n.indexOf(e);t(n[(a+1)%n.length])},id:"environmentMode",children:[(0,v.jsx)("img",{src:eO[e],alt:"enviromentModeIcon"}),(0,v.jsx)("span",{children:e})]})]})},eX=()=>{let{gameMode:{gameMode:e}}=el(),t=eV[e];return(0,v.jsx)(t,{})},eJ=e=>{let{initialEnvironmentMode:t,initialGameMode:n}=e;return(0,v.jsxs)(eo,{initialEnvironmentMode:t,initialGameMode:n,children:[(0,v.jsx)(eY,{}),(0,v.jsx)(eX,{})]})},eq=!0,eQ=e=>{let{initialGameMode:t,initialEnvironmentMode:n}=e;return(0,v.jsx)("div",{id:"root",children:(0,v.jsx)(eJ,{initialEnvironmentMode:n,initialGameMode:t})})};u&&u instanceof Function&&n.e(131).then(n.bind(n,2131)).then(e=>{let{getCLS:t,getFID:n,getFCP:a,getLCP:s,getTTFB:i}=e;t(u),n(u),a(u),s(u),i(u)})}},function(e){e.O(0,[737,447,486,888,774,179],function(){return e(e.s=1492)}),_N_E=e.O()}]);