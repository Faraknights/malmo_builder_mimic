(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{1492:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[gameMode]/[environmentMode]",function(){return a(7090)}])},7090:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSG:function(){return te},default:function(){return tt}});var s,n,r,o,i,l,c,d,p,h,u,m,x,E,g,C,y,I,j,O,N,f,S,A,b,L,T,P,w,R,M,v=a(5893),_=a(7294);function B(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}function D(e,t){for(let a of e)for(let e of t)if(B(a,e))return!0;return!1}function H(e,t){let a=(e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z});return Array.isArray(e)?e.map(e=>a(e,t)):a(e,t)}(s=g||(g={})).MINECRAFT="MINECRAFT",s.COCOBOTS="COCOBOTS";var U=a(9477);(n=C||(C={})).RED="RED",n.BLUE="BLUE",n.GREEN="GREEN",n.ORANGE="ORANGE",n.PURPLE="PURPLE",n.YELLOW="YELLOW",n.WHITE="WHITE",n.BLACK="BLACK",n.NEW="NEW";let z={[C.RED]:{hex:"#ff0000",id:C.RED},[C.BLUE]:{hex:"#1b4ccd",id:C.BLUE},[C.GREEN]:{hex:"#008000",id:C.GREEN},[C.ORANGE]:{hex:"#ff6600",id:C.ORANGE},[C.PURPLE]:{hex:"#ac00e6",id:C.PURPLE},[C.YELLOW]:{hex:"#ffa500",id:C.YELLOW},[C.WHITE]:{hex:"#ffffff",id:C.WHITE},[C.BLACK]:{hex:"#000000",id:C.BLACK},[C.NEW]:{hex:"#deefe1",id:C.NEW}};var G=a(463),k=a(398),W=a(9119);(r=y||(y={})).CELL_BOARD="CELL_BOARD",r.SHAPE="SHAPE",r.SHAPE_FACE="SHAPE_FACE",r.GROUP="GROUP",r.NON_CLICKABLE_FACE="NON_CLICKABLE_FACE",r.SCENE="SCENE",(o=I||(I={})).FRONT="FRONT",o.BACK="BACK",o.TOP="TOP",o.BOTTOM="BOTTOM",o.LEFT="LEFT",o.RIGHT="RIGHT";let F={[I.FRONT]:{translation:new U.Vector3(0,0,.5),rotation:new U.Euler(0,0,0)},[I.BACK]:{translation:new U.Vector3(0,0,-.5),rotation:new U.Euler(0,Math.PI,0)},[I.TOP]:{translation:new U.Vector3(0,.5,0),rotation:new U.Euler(-Math.PI/2,0,0)},[I.BOTTOM]:{translation:new U.Vector3(0,-.5,0),rotation:new U.Euler(Math.PI/2,0,0)},[I.LEFT]:{translation:new U.Vector3(.5,0,0),rotation:new U.Euler(0,Math.PI/2,0)},[I.RIGHT]:{translation:new U.Vector3(-.5,0,0),rotation:new U.Euler(0,-Math.PI/2,0)}},V=e=>{let t=F[e.facingDirection];return(0,v.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:{type:y.SHAPE_FACE,faceDirection:e.facingDirection},children:[(0,v.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,v.jsx)(W.w,{linewidth:1,threshold:15,color:e.color}),(0,v.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};(i=j||(j={}))[i.CUBE=0]="CUBE",i[i.SCREW=1]="SCREW",i[i.NUT=2]="NUT",i[i.WASHER=3]="WASHER",i[i.HORIZONTAL_BRIDGE=4]="HORIZONTAL_BRIDGE",i[i.VERTICAL_BRIDGE=5]="VERTICAL_BRIDGE",i[i.HORIZONTAL_BRIDGE_COMPONENT=6]="HORIZONTAL_BRIDGE_COMPONENT",i[i.VERTICAL_BRIDGE_COMPONENT=7]="VERTICAL_BRIDGE_COMPONENT",i[i.HBRIDGE=8]="HBRIDGE",i[i.VBRIDGE=9]="VBRIDGE";var $=a(7632);class K{constructor(e,t,a,s){this.nbObjects=()=>{let e=0;for(let t of this.shapes)t instanceof K?e+=t.nbObjects():e++;return e},this.objectExists=(e,t,a)=>{for(let s of this.shapes)if(s instanceof K){if(s.objectExists(e-this.startingPoint.x,t-this.startingPoint.y,a-this.startingPoint.z))return!0}else if(e===s.position.x+this.startingPoint.x&&t===s.position.y+this.startingPoint.y&&a===s.position.z+this.startingPoint.z)return!0;return!1},this.getPositions=()=>this.shapes.flatMap(e=>e instanceof K?e.getPositions():H(et[e.shape],e.position)),this.startingPoint=e,this.shapes=t.map(e=>({...e,breakable:!!s})),this.uuid=(0,$.Z)(),this.pending=a,this.breakable=!!s}}let Z=e=>{let{shapeGroup:t}=e;return(0,v.jsx)("mesh",{userData:{type:y.GROUP,position:t.startingPoint,pending:t.pending},children:t.shapes.map((e,a)=>e instanceof K?(0,v.jsx)(Z,{shapeGroup:{...e,breakable:t.breakable}},`group-${a}`):(0,v.jsx)(es,{...e,breakable:t.breakable},`shape-${a}`))})},Y=e=>{let{color:t,pending:a,position:s,breakable:n}=e,r=new K(s,[{color:t,pending:a,position:{x:0,y:0,z:0},shape:j.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,$.Z)()},{color:t,pending:a,position:{x:1,y:0,z:0},shape:j.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,$.Z)()}],a,n);return(0,v.jsx)(Z,{shapeGroup:r})},J={[I.FRONT]:{translation:new U.Vector3(0,0,.5),rotation:new U.Euler(0,0,0),type:y.NON_CLICKABLE_FACE},[I.BACK]:{translation:new U.Vector3(0,0,-.5),rotation:new U.Euler(0,Math.PI,0),type:y.NON_CLICKABLE_FACE},[I.TOP]:{translation:new U.Vector3(0,.5,0),rotation:new U.Euler(-Math.PI/2,0,0),type:y.SHAPE_FACE},[I.BOTTOM]:{translation:new U.Vector3(0,-.5,0),rotation:new U.Euler(Math.PI/2,0,0),type:y.SHAPE_FACE},[I.LEFT]:{translation:new U.Vector3(.5,0,0),rotation:new U.Euler(0,Math.PI/2,0),type:y.NON_CLICKABLE_FACE},[I.RIGHT]:{translation:new U.Vector3(-.5,0,0),rotation:new U.Euler(0,-Math.PI/2,0),type:y.NON_CLICKABLE_FACE}},X=e=>{let t=J[e.facingDirection];return(0,v.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:t.type===y.SHAPE_FACE?{type:y.SHAPE_FACE,faceDirection:e.facingDirection}:{type:y.NON_CLICKABLE_FACE},children:[(0,v.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,v.jsx)(W.w,{linewidth:1,threshold:15,color:e.color}),(0,v.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};var q=e=>{let{pending:t,color:a,rotation:s}=e,n=new U.Color(a.hex);return(0,v.jsx)("mesh",{scale:["HORIZONTAL"===s?1:.6,1,"HORIZONTAL"===s?.6:1],children:Object.entries(I).map(e=>{let[a,s]=e;return(0,v.jsx)(X,{color:n,opacity:t?e7:1,facingDirection:s},a)})})};let Q=e=>{let{color:t,pending:a,position:s,breakable:n}=e,r=new K(s,[{color:t,pending:a,position:{x:0,y:0,z:0},shape:j.VERTICAL_BRIDGE_COMPONENT,uuid:(0,$.Z)()},{color:t,pending:a,position:{x:0,y:0,z:1},shape:j.VERTICAL_BRIDGE_COMPONENT,uuid:(0,$.Z)()}],a,n);return(0,v.jsx)(Z,{shapeGroup:r})},ee={[j.CUBE]:e=>{let{pending:t,color:a}=e,s=new U.Color(a.hex);return(0,v.jsx)(v.Fragment,{children:Object.entries(I).map(e=>{let[a,n]=e;return(0,v.jsx)(V,{color:s,opacity:t?e7:1,facingDirection:n},a)})})},[j.SCREW]:function(e){let{pending:t,position:a,color:s}=e,n=new U.LineCurve3(new U.Vector3(0,-.5,0),new U.Vector3(0,.5,0)),r=new U.Color(s.hex),o=t?e7:1,i=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:r,side:U.FrontSide,transparent:1!==o,opacity:o});return(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE},scale:[.65,1,.65],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,25]}),i]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,25]}),i]}),(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE,position:a,pending:t},children:[(0,v.jsx)("tubeGeometry",{args:[n,1,.5,25,!1]}),1===o&&(0,v.jsx)(W.w,{linewidth:1,color:r.clone().addScalar(.2)}),i]})]})},[j.NUT]:function(e){let{pending:t,position:a,color:s}=e,n=new U.LineCurve3(new U.Vector3(0,-.5,0),new U.Vector3(0,.5,0)),r=new U.Color(s.hex),o=t?e7:1,i=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:r,side:U.FrontSide,transparent:1!==o,opacity:o});return(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE},scale:[1.1,1,1.1],rotation:[0,-Math.PI/4,0],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),i]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),i]}),(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE,position:a,pending:t},children:[(0,v.jsx)("tubeGeometry",{args:[n,1,.5,4,!1]}),1===o&&(0,v.jsx)(W.w,{linewidth:1,color:r.clone().addScalar(.2)}),i]})]})},[j.HORIZONTAL_BRIDGE]:Y,[j.VERTICAL_BRIDGE]:Q,[j.HBRIDGE]:Y,[j.VBRIDGE]:Q,[j.WASHER]:function(e){let{pending:t,color:a}=e,s=new U.LineCurve3(new U.Vector3(0,-.5,0),new U.Vector3(0,.5,0)),n=new U.Color(a.hex),r=t?e7:1,o=(0,v.jsx)("meshStandardMaterial",{attach:"material",color:n,side:U.FrontSide,transparent:1!==r,opacity:r});return(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE},scale:[.95,1,.95],children:[(0,v.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.TOP},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),o,1===r&&(0,v.jsx)(W.w,{linewidth:1,color:n.clone().addScalar(.2)})]}),(0,v.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:y.SHAPE_FACE,faceDirection:I.BOTTOM},children:[(0,v.jsx)("circleGeometry",{args:[.5,4]}),o,1===r&&(0,v.jsx)(W.w,{linewidth:1,color:n.clone().addScalar(.2)})]}),(0,v.jsxs)("mesh",{userData:{type:y.NON_CLICKABLE_FACE},children:[(0,v.jsx)("tubeGeometry",{args:[s,1,.5,4,!1]}),1===r&&(0,v.jsx)(W.w,{linewidth:1,color:n.clone().addScalar(.2)}),o]})]})},[j.HORIZONTAL_BRIDGE_COMPONENT]:e=>(0,v.jsx)(q,{...e,rotation:"HORIZONTAL"}),[j.VERTICAL_BRIDGE_COMPONENT]:e=>(0,v.jsx)(q,{...e,rotation:"VERTICAL"})},et={[j.CUBE]:[{x:0,y:0,z:0}],[j.SCREW]:[{x:0,y:0,z:0}],[j.NUT]:[{x:0,y:0,z:0}],[j.HORIZONTAL_BRIDGE]:[{x:0,y:0,z:0},{x:1,y:0,z:0}],[j.VERTICAL_BRIDGE]:[{x:0,y:0,z:0},{x:0,y:0,z:1}],[j.HBRIDGE]:[{x:0,y:0,z:0},{x:1,y:0,z:0}],[j.VBRIDGE]:[{x:0,y:0,z:0},{x:0,y:0,z:1}],[j.WASHER]:[{x:0,y:0,z:0}],[j.HORIZONTAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}],[j.VERTICAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}]},ea=(e,t,a)=>{let s=e=>[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)],n=s(e),r=s(t);return"#"+n.map((e,t)=>Math.max(0,Math.min(255,Math.round(e+(r[t]-e)*a/100)))).map(e=>e.toString(16).padStart(2,"0")).join("")},es=e=>{let t=ee[e.shape];return(0,v.jsx)("mesh",{userData:{type:y.SHAPE,position:e.position,pending:e.pending,shape:e.shape},position:[e.position.x,e.position.y,e.position.z],children:e.breakable&&(0,v.jsx)(t,{...e,color:{hex:ea(e.color.hex,z.WHITE.hex,40),id:z.WHITE.id}})||(0,v.jsx)(t,{...e})})};(l=O||(O={})).SIMULATION="SIMULATION",l.VISUALIZATION="VISUALIZATION",l.NEBULA="NEBULA",l.DIRECT_INSTRUCTIONS="DIRECT_INSTRUCTIONS";var en=a(2473);let er=e=>{let{position:t}=e;return(0,v.jsxs)("mesh",{userData:{type:y.CELL_BOARD,position:t},rotation:[-Math.PI/2,0,0],position:[t.x,.5,t.z],children:[(0,v.jsx)("planeGeometry",{args:[1,1]}),(0,v.jsx)(W.w,{linewidth:1,threshold:15,color:"black"}),(0,v.jsx)("meshStandardMaterial",{color:[e6.r,e6.g,e6.b],side:U.FrontSide})]})};var eo=e=>{let{environmentMode:t}=e,a=eJ[t];return(0,v.jsxs)(v.Fragment,{children:[Array.from({length:a.x.max-a.x.min+1},(e,t)=>a.x.min+t).map(e=>(0,v.jsx)(_.Fragment,{children:Array.from({length:a.z.max-a.z.min+1},(e,t)=>a.z.min+t).map(t=>(0,v.jsx)(er,{position:{x:e,y:0,z:t}},`${e},${t}`))},e)),(0,v.jsx)(en.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,0],position:[(a.x.max+a.x.min)/2,.5,a.z.min-2],color:"white",anchorX:"center",anchorY:"middle",children:"N"}),(0,v.jsx)(en.x,{scale:[1,1,1],rotation:[Math.PI/2,0,0],position:[a.x.max+2,.5,(a.z.max+a.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"E"}),(0,v.jsx)(en.x,{scale:[1,1,1],rotation:[Math.PI/2,0,Math.PI],position:[a.x.min-2,.5,(a.z.max+a.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"W"}),(0,v.jsx)(en.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,Math.PI],position:[(a.x.max+a.x.min)/2,.5,a.z.max+2],color:"white",anchorX:"center",anchorY:"middle",children:"S"})]})};(c=N||(N={})).PLACE="PLACE",c.BREAK="REMOVE";let ei={[I.FRONT]:{x:0,y:0,z:1},[I.BACK]:{x:0,y:0,z:-1},[I.TOP]:{x:0,y:1,z:0},[I.BOTTOM]:{x:0,y:-1,z:0},[I.LEFT]:{x:1,y:0,z:0},[I.RIGHT]:{x:-1,y:0,z:0}},el=()=>{let[e,t]=(0,_.useState)([]),[a,s]=(0,_.useState)(),n=e=>{t(t=>[...t,e])};return{objects:e,pending:a,setObjects:t,setPending:s,nbObjects:()=>{let t=0;for(let a of e)a instanceof K?t+=a.nbObjects():t++;return t},objectExists:(t,a,s)=>{for(let n of e)if(n instanceof K){if(n.objectExists(t,a,s))return!0}else if(t===n.position.x&&a===n.position.y&&s===n.position.z)return!0;return!1},addObject:n,removeObject:(e,a,s)=>{t(t=>t.filter(t=>{if(t instanceof K){if(t.objectExists(e,a,s))return!1}else if(t.position.x===e&&t.position.y===a&&t.position.z===s)return!1;return!0}))},clear:()=>{t([])},confirmPending:e=>{a&&n({...a,pending:!1}),s(e)},setBreaking:e=>{let a=e=>e.breakable?e:{...e,breakable:!0};t(t=>t.map(t=>t instanceof K&&B(t.startingPoint,e)?a(t):"position"in t&&B(t.position,e)?a(t):t))},removeBreaking:()=>{let e=e=>({...e,breakable:!1});t(t=>t.map(t=>t.breakable?e(t):t))},getPosition:()=>e.flatMap(e=>H(et[e.shape],e.position))}},ec=(e,t)=>{let[a,s]=(0,_.useState)(e[0]),[n,r]=(0,_.useState)(e),[o,i]=(0,_.useState)(t[0]),[l,c]=(0,_.useState)(t);return{currentColor:a,colors:n,currentShape:o,shapes:l,setCurrentColor:s,setColors:r,setCurrentShape:i,setShapes:c,changeColor:e=>{s(z[e])}}},ed=()=>{let[e,t]=(0,_.useState)([]);return{chatHistory:e,setChatHistory:t,addMessage:e=>{e.content&&t(t=>[...t,e])},clear:()=>{t([])}}};class ep{constructor(){this.gameLog=[{chatHistory:[],shapeInPlace:[],timestamp:new Date}]}getLength(){return this.gameLog.length}addWorldState(e){this.gameLog.push(e)}clear(){this.gameLog=[]}getLastWorldState(){let e=this.gameLog[this.gameLog.length-1];return e?e.timestamp?{timestamp:e.timestamp,chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:{chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:void 0}getWorldStateById(e){if(e<this.gameLog.length){let t=this.gameLog[e];return t.timestamp?{timestamp:t.timestamp,chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}:{chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}}}}let eh=(0,_.createContext)(void 0),eu=e=>{let{children:t,initialEnvironmentMode:a,initialGameMode:s}=e,[n,r]=(0,_.useState)(a),[o,i]=(0,_.useState)(s),[l,c]=(0,_.useState)(e3[s]),[d,p]=(0,_.useState)(new ep),[h,u]=(0,_.useState)(e2[a]),m=el(),x=ed(),E=ec(eZ[a],eY[a]),[g,C]=(0,_.useState)(void 0),y=()=>{c(e3[o]),p(new ep),m.clear(),x.setChatHistory([]),E.setColors(eZ[n]),E.setCurrentColor(eZ[n][0]),E.setShapes(eY[n]),E.setCurrentShape(eY[n][0]),u(e2[n]),C(void 0)};return(0,_.useEffect)(y,[n,o]),(0,_.useEffect)(()=>{let e=d.getLastWorldState();e?(m.objects.length!==e.shapeInPlace.length||x.chatHistory.length!==e.chatHistory.length)&&(d.addWorldState({timestamp:new Date,chatHistory:[...x.chatHistory],shapeInPlace:[...m.objects]}),p(d)):(0!==m.objects.length||0!==x.chatHistory.length)&&(d.addWorldState({timestamp:new Date,chatHistory:[...x.chatHistory],shapeInPlace:[...m.objects]}),p(d))},[m.objects,x.chatHistory]),(0,v.jsx)(eh.Provider,{value:{environmentMode:{environmentMode:n,setEnvironmentMode:r},gameMode:{gameMode:o,setGameMode:i},action:{action:l,setAction:c},pointer:{pointer:g,setPointer:C},gameLog:{gameLog:d,setGameLog:p},camera:{camera:h,setCamera:u},shapeInPlace:m,inventory:E,chat:x,clear:y},children:t})},em=()=>{let e=(0,_.useContext)(eh);if(void 0===e)throw Error("useGlobalState must be used within a GlobalStateProvider");return e};function ex(e){if(e.userData.type===y.SHAPE||e.userData.type!==y.NON_CLICKABLE_FACE&&e.userData.type!==y.SHAPE_FACE)return e;{let t=e;for(;t.userData.type!==y.SHAPE;)t.parent&&(t=t.parent);return t}}function eE(e){let t={x:0,y:0,z:0};e.userData.type===y.SHAPE?t=H(t,e.userData.position):e.userData.type===y.GROUP&&(t=H(t,e.userData.position));let a=e.parent;return a.userData.type===y.GROUP?H(t,eE(a)):t}var eg=()=>{let{gameMode:{gameMode:e},environmentMode:{environmentMode:t},pointer:{setPointer:a},shapeInPlace:s,inventory:n,action:r}=em(),{objects:o,pending:i}=s,[l,c]=(0,_.useState)(null),d=(e,a,r)=>{let o={uuid:(0,$.Z)(),pending:!0,breakable:!1,color:n.currentColor,position:e,shape:a};return eQ[t](o,H(et[o.shape],o.position),s.getPosition(),r)},p=e=>{let t=e.intersections[0].object,a=ex(t);if(t.userData.type===y.SHAPE_FACE){let e=t.userData,r=H(eE(a),ei[e.faceDirection]);s.confirmPending(d(r,n.currentShape,!0))}else s.confirmPending();e.stopPropagation()},h=e=>{if(e.intersections[0]){let t=ex(e.intersections[0].object);if(t.userData.type===y.SHAPE){for(;t.parent?.userData.type===y.GROUP;)t=t.parent;let e=eE(t);s.removeObject(e.x,e.y,e.z)}m(e.intersections.slice(1))}e.stopPropagation()},u=e=>{if(e[0]){let t=e[0].object;if(t.userData.type===y.CELL_BOARD){let e=t.userData,a=s.pending,r={...e.position,y:e.position.y+1};a&&B(a instanceof K?a.startingPoint:a.position,r)||s.setPending(d(r,n.currentShape))}else if(t.userData.type===y.SHAPE_FACE){let e=t.userData,a=ex(t);if(!(a?.userData).pending){let t=s.pending,r=H(eE(a),ei[e.faceDirection]);t&&D([t instanceof K?t.startingPoint:t.position],[r])||s.setPending(d(r,n.currentShape))}}else s.setPending(void 0)}},m=e=>{if(e[0]){s.removeBreaking();let t=ex(e[0].object);if(t.userData.type===y.SHAPE){for(;t.parent?.userData.type===y.GROUP;)t=t.parent;let e=eE(t);a&&a({cartesianCoordinate:e,type:y.SHAPE}),s.setBreaking(e)}else if(t.userData.type===y.CELL_BOARD){let e=t.userData;a&&a({cartesianCoordinate:e.position,type:y.CELL_BOARD})}}},x=(0,_.useMemo)(()=>o.map(e=>e instanceof K?(0,v.jsx)(Z,{shapeGroup:{...e}},`${e.uuid}-${e.breakable}-${e.pending}`):(0,v.jsx)(es,{...e},`${e.uuid}-${e.breakable}-${e.pending}`)),[o]),E=(0,_.useMemo)(()=>i&&e===O.SIMULATION&&(i instanceof K?(0,v.jsx)(Z,{shapeGroup:i},i.uuid):(0,v.jsx)(es,{...i},i.uuid)),[i,e]);return(0,v.jsxs)("mesh",{onPointerDown:e=>c({x:e.clientX,y:e.clientY}),onPointerMove:e=>{let t=e.intersections.filter(e=>{let t=ex(e.object);return t.userData.type!==y.SHAPE||!t.userData.pending});r.action===N.PLACE?u(t):m(t)},onPointerOut:e=>{0===e.intersections.length&&(s.setPending(void 0),s.removeBreaking(),a&&a(void 0))},onPointerUp:t=>{if(l&&e===O.SIMULATION){let e=Math.abs(t.clientX-l.x),a=Math.abs(t.clientY-l.y);e<5&&a<5&&(r.action===N.PLACE?s.pending&&p(t):r.action===N.BREAK&&h(t))}c(null)},scale:[eK[t].x,eK[t].y,eK[t].z],userData:{type:y.SCENE},children:[(0,v.jsx)(eo,{environmentMode:t},t),x,E]})};(d=f||(f={})).FREE="Free camera",d.SIDE_VIEW="Side view",d.UPPER_VIEW="Upper view";let eC={[f.FREE]:{orthographic:!1,polarAngle:{max:Math.PI,min:0},cameraSettings:{fov:75,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e3,position:[0,5,10]}},[f.SIDE_VIEW]:{orthographic:!0,polarAngle:{max:Math.PI/2,min:Math.PI/2},cameraSettings:{zoom:50,position:[100,5,10]}},[f.UPPER_VIEW]:{orthographic:!0,polarAngle:{max:0,min:0},cameraSettings:{zoom:50,position:[0,5,10]},azimuthAngle:{max:0,min:0}}},ey=()=>{let{environmentMode:{environmentMode:e}}=em(),t=eJ[e];return(0,v.jsx)("mesh",{position:[-(t.x.max+t.x.min)/2,1,-(t.z.max+t.z.min)/2],children:(0,v.jsx)(eg,{})})};var eI=()=>{let e=new U.Color(1710878),{camera:t}=em().camera,a=(0,_.useMemo)(()=>(0,v.jsx)(ey,{}),[]);return(0,v.jsxs)(G.Xz,{gl:{preserveDrawingBuffer:!0},frameloop:"demand",orthographic:eC[t].orthographic,camera:eC[t].cameraSettings,children:[a,(0,v.jsx)(k.z,{enablePan:!1,minPolarAngle:eC[t].polarAngle.min,maxPolarAngle:eC[t].polarAngle.max,minAzimuthAngle:eC[t].azimuthAngle?.min,maxAzimuthAngle:eC[t].azimuthAngle?.max}),(0,v.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,v.jsx)("ambientLight",{intensity:1}),(0,v.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200}),(0,v.jsx)("color",{attach:"background",args:[e.r,e.g,e.b]})]},t)},ej=e=>{let{children:t}=e;return(0,v.jsx)("div",{id:"side",children:t})},eO=()=>{let{currentColor:e,colors:t,changeColor:a}=em().inventory,s=[];for(let e=0;e<t.length;e+=4)s.push(t.slice(e,e+4));return(0,v.jsxs)("div",{id:"colorPicker",className:"module",children:[(0,v.jsx)("h3",{children:"Color Picker"}),(0,v.jsx)("div",{id:"colorList",children:s.map((t,s)=>(0,v.jsx)("div",{children:t.map(t=>(0,v.jsx)("div",{className:`realisticButton color${e.id===t.id?" selected":""}`,style:{backgroundColor:t.hex},onMouseDown:()=>a(t.id),children:(0,v.jsx)("span",{children:t.id[0]+t.id.slice(1).toLowerCase()})},t.id))},s))})]})},eN=()=>{let{action:e,setAction:t}=em().action;return(0,v.jsxs)("div",{id:"actionSelector",className:"module",children:[(0,v.jsx)("h3",{children:"Action:"}),(0,v.jsx)("div",{className:"buttonsWrapper",children:Object.values(N).map(a=>(0,v.jsx)("button",{className:`realisticButton ${a}${e===a?" selected":""}`,onMouseDown:()=>t(a),children:a[0]+a.slice(1).toLowerCase()},a))})]})},ef=()=>{let{inventory:{currentColor:e,currentShape:t,shapes:a,setCurrentShape:s},environmentMode:{environmentMode:n}}=em(),r=[];for(let e=0;e<a.length;e+=2)r.push(a.slice(e,e+2));return a.length>1&&(0,v.jsxs)("div",{id:"shapePicker",className:"module",children:[(0,v.jsx)("h3",{children:"Shape Picker"}),(0,v.jsx)("div",{id:"colorList",children:r.map((a,r)=>(0,v.jsx)("div",{children:a.map(a=>{let r=et[a],o=r.map(e=>e.x),i=r.map(e=>e.z);return(0,v.jsxs)("div",{className:`color${t===a?" selected":""}`,onClick:()=>s(a),children:[(0,v.jsxs)(G.Xz,{frameloop:"demand",camera:{position:[0,2,0],far:1e3},children:[(0,v.jsx)("mesh",{scale:[eK[n].x,eK[n].y,eK[n].z],position:[-((Math.max(...o)-Math.min(...o))/2),0,-((Math.max(...i)-Math.min(...i))/2)],children:(0,v.jsx)(es,{breakable:!1,pending:!1,color:e,position:{x:0,y:0,z:0},shape:a,uuid:j[a]})}),(0,v.jsx)(k.z,{}),(0,v.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,v.jsx)("ambientLight",{intensity:1}),(0,v.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200})]}),(0,v.jsx)("span",{children:j[a][0]+j[a].slice(1).toLowerCase().replace("_"," ")})]},a)})},r))})]})||(0,v.jsx)(v.Fragment,{})},eS=a(1375);(p=S||(S={})).SYSTEM="SYSTEM",p.ARCHITECT="ARCHITECT",p.BUILDER="BUILDER",p.NEBULA="NEBULA",p.UNKNOWN="UNKNOWN";let eA={[S.ARCHITECT]:"/assets/icons/Users/architect.png",[S.BUILDER]:"/assets/icons/Users/builder.png",[S.SYSTEM]:"/assets/icons/Users/settings.png",[S.NEBULA]:"/assets/icons/Users/robot.png",[S.UNKNOWN]:"/assets/icons/Users/unknown.png"},eb={[g.COCOBOTS]:"/assets/icons/environmentMode/cocobots.png",[g.MINECRAFT]:"/assets/icons/environmentMode/minecraft.png"};(h=A||(A={})).PLACEMENT="Shapes placed.",h.WAIT="Please Wait",h.WRONG_FILE_EXTENSION="The extension file is incorrect.",h.NOT_ENOUGH_PLAYERS="Not enough players showed up.";var eL=a(1163);function eT(){return(eT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(null,arguments)}var eP=e=>_.createElement("svg",eT({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,fill:"none",viewBox:"0 0 24 24"},e),b||(b=_.createElement("path",{fill:"#1C274C",d:"M12.554 16.506a.75.75 0 0 1-1.107 0l-4-4.375a.75.75 0 0 1 1.107-1.012l2.696 2.95V3a.75.75 0 0 1 1.5 0v11.068l2.697-2.95a.75.75 0 1 1 1.107 1.013z"})),L||(L=_.createElement("path",{fill:"#1C274C",d:"M3.75 15a.75.75 0 0 0-1.5 0v.055c0 1.367 0 2.47.117 3.337.12.9.38 1.658.981 2.26.602.602 1.36.86 2.26.982.867.116 1.97.116 3.337.116h6.11c1.367 0 2.47 0 3.337-.116.9-.122 1.658-.38 2.26-.982s.86-1.36.982-2.26c.116-.867.116-1.97.116-3.337V15a.75.75 0 0 0-1.5 0c0 1.435-.002 2.436-.103 3.192-.099.734-.28 1.122-.556 1.399-.277.277-.665.457-1.4.556-.755.101-1.756.103-3.191.103H9c-1.435 0-2.437-.002-3.192-.103-.734-.099-1.122-.28-1.399-.556-.277-.277-.457-.665-.556-1.4-.101-.755-.103-1.756-.103-3.191"}))),ew=e=>{let{availableUsers:t}=e,a=(0,_.useRef)(null),s=(0,eL.useRouter)(),{chat:n,gameLog:{gameLog:r},gameMode:{gameMode:o},environmentMode:{environmentMode:i},shapeInPlace:l}=em();(0,_.useEffect)(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[n.chatHistory]);let[c,d]=(0,_.useState)(S.ARCHITECT),[p,h]=(0,_.useState)(!1),[u,m]=(0,_.useState)(!1);return(0,v.jsxs)("div",{id:"chat",className:"module",children:[(0,v.jsx)("h3",{onClick:()=>{l.addObject({breakable:!1,color:z.BLUE,pending:!1,position:{x:-3,y:1,z:5},shape:j.SCREW,uuid:"1"}),l.addObject({breakable:!1,color:z.BLUE,pending:!1,position:{x:-2,y:2,z:4},shape:j.SCREW,uuid:"1"}),l.addObject({breakable:!1,color:z.BLUE,pending:!1,position:{x:-2,y:3,z:3},shape:j.SCREW,uuid:"1"}),l.addObject({breakable:!1,color:z.BLUE,pending:!1,position:{x:-2,y:4,z:2},shape:j.SCREW,uuid:"1"}),l.addObject({breakable:!1,color:z.BLUE,pending:!1,position:{x:-2,y:5,z:1},shape:j.SCREW,uuid:"1"})},children:"Chat"}),(0,v.jsx)("hr",{}),(0,v.jsx)("div",{className:"historyMessages",ref:a,children:n.chatHistory.map((e,t)=>(0,v.jsxs)("div",{children:[(0===t||e.user!==n.chatHistory[t-1].user)&&(0,v.jsxs)("div",{children:[(0,v.jsx)("img",{className:"userIcon",src:`${s.basePath}${eA[Object.keys(S).includes(e.user.toUpperCase())?e.user.toUpperCase():S.UNKNOWN]}`,alt:"userIcon"}),(0,v.jsx)("span",{className:"userName",children:e.user[0]+e.user.slice(1).toLowerCase()},`user-${t}`)]}),(0,v.jsx)("div",{className:`message${e.user===S.SYSTEM?" system":""}`,children:e.content},t)]},t))}),t.length>=1&&(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("hr",{}),(0,v.jsxs)("div",{className:"buttons",children:[(0,v.jsxs)("div",{className:"mainButtons",children:[(0,v.jsx)("button",{className:1!==t.length?"realisticButton":"alone",onMouseDown:()=>{d(t[(t.findIndex(e=>e===c)+1)%t.length])},children:c}),(0,v.jsx)("input",{type:"text",className:p?"disable":"",disabled:p,placeholder:"writing here...",onKeyDown:e=>{if("Enter"===e.key){let t=e.currentTarget.value;if(n.addMessage({content:t,user:c}),e.currentTarget.value="",o===O.DIRECT_INSTRUCTIONS){if(/^place\(".+", ".+", [0-9]+, [0-9]+, [0-9]+\)(\s)?$/gm.test(t)){let e=/\("([^"]+)", "([^"]+)", (\d+), (\d+), (\d+)\)/;t.split("place").slice(1).forEach(t=>{let a=t.match(e);console.log(a),l.addObject({breakable:!1,color:z[a[2].toUpperCase()]||z.WHITE,shape:j[a[1].toUpperCase()]||j.CUBE,pending:!1,position:{x:parseInt(a[3]),y:parseInt(a[4]),z:parseInt(a[5])},uuid:"test"})})}else console.log(t),n.addMessage({user:S.SYSTEM,content:"Not a right placement structure"})}}}})]}),o===O.NEBULA&&(0,v.jsxs)("div",{className:"nebulaWrapperButtons",children:[(0,v.jsx)("button",{className:"realisticButton generate"+(p||0===(n.chatHistory.some(e=>e.user===S.SYSTEM&&e.content===A.PLACEMENT)?n.chatHistory.slice(n.chatHistory.reduceRight((e,t,a)=>-1===e&&t.user===S.SYSTEM&&t.content===A.PLACEMENT?a:e,-1)+1):n.chatHistory.filter(e=>e.user!==S.SYSTEM)).length?" disabled":""),onMouseDown:()=>{m(!0);let e=(n.chatHistory.some(e=>e.user===S.SYSTEM&&e.content===A.PLACEMENT)?n.chatHistory.slice(n.chatHistory.reduceRight((e,t,a)=>-1===e&&t.user===S.SYSTEM&&t.content===A.PLACEMENT?a:e,-1)+1):n.chatHistory.filter(e=>e.user!==S.SYSTEM)).map(e=>e.content).join(". ");console.log(e),o===O.NEBULA&&(async()=>{let t=i===g.MINECRAFT?"/api/nebula_minecraft":"/api/nebula_cocobots";await (0,eS.L)(s.basePath+t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e}),onmessage:async e=>{if(e.data){let t="";t=!function(e){if("string"!=typeof e)return!1;0===e.indexOf("data:")&&(e=e.split(",")[1]);try{return btoa(atob(e))===e}catch(e){return!1}}(e.data)?e.data:atob(e.data);try{let e=JSON.parse(t);if(m(!1),"WAIT"===e.type)n.addMessage({content:e.content,user:S.SYSTEM}),h(!0);else if("MESSAGE"===e.type){if(console.log(/^(place .*|pick) -?[0-9]+ -?[0-9]+ -?[0-9]+\n?$/gm.test(e.content)),/^(place .*|pick) -?[0-9]+ -?[0-9]+ -?[0-9]+\n?$/gm.test(e.content)){let t=e.content.trim().split("\n"),a=new ep;a.gameLog[0].shapeInPlace=l.objects,t.forEach(e=>{!function(e,t,a){let s=e.trim(),n=t.getLastWorldState();if(s.startsWith("place")){let e=s.split(" ");a===g.MINECRAFT?n?.shapeInPlace.push({pending:!1,breakable:!1,uuid:$.Z(),color:z[e[1].toUpperCase()],position:{x:parseInt(e[2]),y:parseInt(e[3]),z:parseInt(e[4])},shape:j.CUBE}):a===g.COCOBOTS&&n?.shapeInPlace.push({pending:!1,breakable:!1,uuid:$.Z(),color:z[e[2].toUpperCase()],position:{x:parseInt(e[3]),y:parseInt(e[4]),z:parseInt(e[5])},shape:j[e[1].toUpperCase()]})}else if(s.startsWith("pick")){let e=s.split(" "),t={x:parseInt(e[1]),y:parseInt(e[2]),z:parseInt(e[3])};n.shapeInPlace=n.shapeInPlace.filter(e=>e.position.x!==t.x||e.position.y!==t.y||e.position.z!==t.z)}else{let e=s.split(/<(.*)> (.*)/);e[1]&&e[2]&&n?.chatHistory.push({user:S[e[1].toUpperCase()],content:e[2]})}t.addWorldState(n)}(e.trim(),a,i)}),console.log(a),async function(e){for(let t=1;t<e.gameLog.length;t++){let a=e.gameLog[t];l.setObjects(a.shapeInPlace),await new Promise(e=>setTimeout(e,200))}n.addMessage({user:S.SYSTEM,content:A.PLACEMENT})}(a)}else n.addMessage({content:e.content,user:S.NEBULA});h(!1)}}catch(e){console.error("Failed to parse JSON:",e)}}}})})()},children:u?(0,v.jsx)("img",{src:`${s.basePath}/assets/images/loading_colorful.gif`,alt:"loading image"}):(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)("span",{children:"Generate"}),(0,v.jsx)("svg",{version:"1.0",viewBox:"0 0 200 200",children:(0,v.jsxs)("g",{transform:"translate(0,200) scale(0.1,-0.1)",fill:"#000000",stroke:"none",children:[(0,v.jsx)("path",{d:"M1426 1808 c-9 -12 -16 -30 -16 -40 0 -9 -11 -48 -25 -85 -37 -103 -78 -134 -236 -177 -58 -16 -76 -37 -58 -68 5 -9 39 -23 76 -32 38 -10 90 -29 118 -44 59 -32 95 -90 121 -195 27 -110 80 -116 103 -10 18 82 57 159 94 187 27 21 88 44 197 75 28 8 39 44 20 66 -6 7 -27 16 -47 20 -60 11 -141 45 -174 72 -37 32 -63 81 -84 164 -9 35 -21 70 -27 77 -16 19 -45 14 -62 -10z"}),(0,v.jsx)("path",{d:"M791 1451 c-7 -5 -27 -60 -43 -122 -77 -293 -153 -370 -442 -449 -122 -33 -131 -37 -134 -61 -4 -34 10 -43 98 -64 115 -27 229 -71 287 -111 89 -61 152 -180 198 -374 21 -88 30 -102 64 -98 24 3 28 12 61 133 43 157 74 225 130 288 55 62 167 116 319 154 95 23 115 32 124 52 10 20 8 26 -12 42 -13 11 -31 19 -41 19 -34 0 -196 51 -267 84 -130 62 -194 154 -247 358 -40 148 -56 174 -95 149z"})]})})]})}),(0,v.jsx)("button",{className:"realisticButton download",onMouseDown:()=>{let e=new Blob([JSON.stringify(e0[i](r))],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="gameLog.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)},children:(0,v.jsx)(eP,{})})]})]})]})]})},eR=()=>{let e=em().camera;return(0,v.jsx)("div",{id:"cameraSelector",className:"module",children:Object.values(f).map(t=>(0,v.jsx)("button",{className:`${t}${e.camera===t?" selected":""}`,onClick:()=>e.setCamera(t),children:t[0]+t.slice(1).toLowerCase()},t))})};function eM(){return(eM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(null,arguments)}var ev=e=>_.createElement("svg",eM({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,viewBox:"0 0 512 512"},e),T||(T=_.createElement("path",{fill:"#000",fillRule:"evenodd",d:"M149.333 42.667v64h256v256h64v42.666h-64v64h-42.666v-64h-256V42.667zm59.67 232.64-59.67 63.782v23.578h213.334v-11.275l-45.568-45.557-38.773 38.791zm153.664-125.974H149.333V276.65L208 213.96l70.315 70.328 38.799-38.79 45.553 45.554zM288 170.667c17.673 0 32 14.327 32 32s-14.327 32-32 32-32-14.327-32-32 14.327-32 32-32m-181.333-64v42.666h-64v-42.666z"})));function e_(){return(e_=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var s in a)({}).hasOwnProperty.call(a,s)&&(e[s]=a[s])}return e}).apply(null,arguments)}var eB=e=>_.createElement("svg",e_({xmlns:"http://www.w3.org/2000/svg",width:800,height:800,fill:"none",viewBox:"0 0 24 24"},e),P||(P=_.createElement("path",{stroke:"#000",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 3v5m0 0h5M3 8l3-2.708A9 9 0 1 1 12 21a9 9 0 0 1-8.777-7"})));(u=w||(w={})).JSON="json",u.JSONL="jsonl",u.CSV="csv",(m=R||(R={})).join="join",m.set_text="set_text",m.set_attribute="set_attribute",m.text_message="text_message",m.command="command",m.target_board_log="target_board_log",m.mouse="mouse",m.user_selection="user_selection",m.working_board_log="working_board_log",m.points="points",m.survey_result="survey_result",m.confirmation_log="confirmation_log",m.leave="leave",(x=M||(M={})).init="init",x.instruction="instruction",x.typing="typing",x.show_progress="show_progress",x.next_state="next_state",x.confirm_next_episode="confirm_next_episode",x.survey="survey",x.submit_survey="submit_survey",x.clear_board="clear_board";let eD=/^<([^>]+)> (.+)$/,eH=(e,t)=>{let a=new ep;a.clear();let s={chatHistory:[],shapeInPlace:[],timestamp:new Date};return e.forEach(e=>{s.shapeInPlace.push({color:z[e.color.toUpperCase()]||z.WHITE,breakable:!1,pending:!1,position:{x:e.position.x,y:e.position.y,z:e.position.z},shape:j[e.shape.toUpperCase()]||j.CUBE,uuid:(0,$.Z)()}),a.addWorldState(structuredClone(s))}),t.push(a),t},eU=(e,t)=>{let a=new ep;return a.clear(),e.worldStates.forEach(e=>{a.addWorldState({chatHistory:e.chatHistory.map(e=>{let t=e.match(eD);return{user:t[1],content:t[2]}}),shapeInPlace:e.blocksInGrid.map(e=>({breakable:!1,pending:!1,color:z[e.color.toUpperCase()]||z.WHITE,position:{x:e.position.x,y:e.position.y,z:e.position.z},shape:j[e.shape.toUpperCase()]||j.CUBE,uuid:(0,$.Z)()})),timestamp:new Date})}),t.push(a),t},ez=/^<([^>]+)> (.+)$/,eG=(e,t)=>{let a=new ep;a.clear();let s={chatHistory:[],shapeInPlace:[],timestamp:new Date};return e.forEach(e=>{s.shapeInPlace.push({color:z[e.colour.toUpperCase()]||z.WHITE,breakable:!1,pending:!1,position:{x:e.x,y:e.y,z:e.z},shape:j.CUBE,uuid:(0,$.Z)()}),a.addWorldState(structuredClone(s))}),t.push(a),t},ek=(e,t)=>{let a=new ep;return a.clear(),e.worldStates.forEach(e=>{a.addWorldState({chatHistory:e.chatHistory.map(e=>{let t=e.match(ez);return{user:t[1],content:t[2]}}),shapeInPlace:e.blocksInGrid.map(e=>({breakable:!1,pending:!1,color:z[e.colour.toUpperCase()]||z.WHITE,position:{x:e.x,y:e.y,z:e.z},shape:j.CUBE,uuid:(0,$.Z)()})),timestamp:new Date})}),t.push(a),t},eW={[g.MINECRAFT]:{[w.CSV]:(e,t)=>{let a;let s=/"(.+?)","?(.*?)"?(?=(\n"|$))/gs;for(;null!==(a=s.exec(e));){let[e,s]=[a[1],a[2]],n=e.split("\n").map(e=>e.trim()),r=new ep;[...n,...s.split("\n").map(e=>e.trim())].forEach(e=>{r.addWorldState(function(e,t){let a=e.trim();if(a.startsWith("place")){let e=a.split(" ");t.shapeInPlace.push({pending:!1,breakable:!1,uuid:(0,$.Z)(),color:z[e[1].toUpperCase()]||z.WHITE,position:{x:parseInt(e[2],10),y:parseInt(e[3],10),z:parseInt(e[4],10)},shape:j.CUBE})}else if(a.startsWith("pick")){let e=a.split(" "),s={x:parseInt(e[1],10),y:parseInt(e[2],10),z:parseInt(e[3],10)},n=t.shapeInPlace.findIndex(e=>e.position.x===s.x&&e.position.y===s.y&&e.position.z===s.z);-1!==n?t.shapeInPlace.splice(n,1):t.chatHistory.push({user:S.SYSTEM,content:`An attempt was made to pick at coordinates [x: ${parseInt(e[1],10)}, y: ${parseInt(e[2],10)}, z: ${parseInt(e[3],10)}]`})}else{let[,e,s]=a.split(/<(.*)> (.*)/)||[];e&&s&&t.chatHistory.push({user:S[e.toUpperCase()]||S.UNKNOWN,content:s})}return t}(e.trim(),r.getLastWorldState()))}),t.push(r)}return t},[w.JSON]:(e,t)=>{let a=JSON.parse(e);return"worldStates"in a?ek(a,t):eG(a,t)}},[g.COCOBOTS]:{[w.JSON]:(e,t)=>{let a=JSON.parse(e);return"worldStates"in a?eU(a,t):eH(a,t)},[w.JSONL]:(e,t)=>{let a=new ep,s={chatHistory:[],shapeInPlace:[],timestamp:new Date};return e.split("\n").filter(e=>/\s/.test(e)).map(e=>JSON.parse(e)).forEach(e=>{switch(e.event){case R.set_text:s.chatHistory.push({user:S.SYSTEM,content:e.data.text}),a.addWorldState(structuredClone(s));break;case R.text_message:if(e.data.html){let t=new DOMParser().parseFromString(e.data.message,"text/html");if(t.body.textContent)switch(t.body.textContent){case"The current working board was updated for your partner":s.shapeInPlace=s.shapeInPlace.map(e=>({...e,pending:!1})),a.addWorldState(structuredClone(s));break;case"Your working board was updated":break;default:s.chatHistory.push({user:S.SYSTEM,content:t.body.textContent}),a.addWorldState(structuredClone(s))}}else s.chatHistory.push({user:`User ${e.user_id}`,content:e.data.message}),a.addWorldState(structuredClone(s));break;case R.command:switch(e.data.command.event){case M.confirm_next_episode:"yes"===e.data.command.answer&&(s.shapeInPlace=[]);break;case M.clear_board:s.shapeInPlace=[],a.addWorldState(structuredClone(s))}break;case R.working_board_log:{let t=Object.values(e.data.objs);console.log(t);let n=a.getLastWorldState();if(t.length>n.shapeInPlace.length){let e=t[t.length-1],a=n.shapeInPlace.map(e=>H(et[e.shape],e.position)).flat().filter(t=>t.x===e.x&&t.z===e.y);console.log(a),s.shapeInPlace.push({pending:!0,breakable:!1,color:z[e.color[0].toUpperCase()]||z.WHITE,position:{x:e.x,y:a.length?Math.max(...a.map(e=>e.y))+1:1,z:e.y},shape:j[e.type.toUpperCase()]||j.CUBE,uuid:(0,$.Z)()})}else if(t.length<n.shapeInPlace.length){let e=n.shapeInPlace.map(e=>({x:e.position.x,y:e.position.z})).map((e,a)=>t.some(t=>t.x===e.x&&t.y===e.y)?-1:a).filter(e=>-1!==e).pop();void 0!==e&&s.shapeInPlace.splice(e,1)}a.addWorldState(structuredClone(s))}}}),t.push(a),t}}},eF=_.memo(e=>{let{currentIndex:t,currentgameId:a,onClick:s,searched:n}=e;return(0,v.jsxs)("div",{className:`game ${t===a?"selected":""} ${n?"searched":""}`,onClick:s,children:[(0,v.jsx)("div",{className:"new"}),(0,v.jsxs)("span",{children:["Game ",t]})]})});eF.displayName="GameComponent";var eV=()=>{let{environmentMode:{environmentMode:e},chat:t,shapeInPlace:a}=em(),[s,n]=(0,_.useState)([]),[r,o]=(0,_.useState)(0),[i,l]=(0,_.useState)(0),[c,d]=(0,_.useState)("");(0,_.useEffect)(()=>{n([])},[e]),(0,_.useEffect)(()=>{let e=s[r]?.gameLog.reduce((e,t,a,s)=>t.chatHistory.length!==(s[a-1]?.chatHistory.length??0)?a:e,0);e?l(e):l(0)},[r]),(0,_.useEffect)(()=>{if(s[r]){let e=s[r].getWorldStateById(i);e&&(a.setObjects(e.shapeInPlace),t.setChatHistory(e.chatHistory))}},[r,i]);let p=async a=>{let r=a.target.files&&a.target.files[0];if(r){let o=r.name.split(".").pop()?.toLowerCase(),i=void 0!==o&&Object.values(w).includes(o)?eW[e][o]:void 0;if(i){let e=new FileReader;e.onload=e=>{n([...i(e.target?.result,s)])},e.readAsText(r)}else t.addMessage({user:S.SYSTEM,content:A.WRONG_FILE_EXTENSION});a.target.value=""}};return(0,v.jsxs)("div",{id:"fileManager",className:"module",children:[(0,v.jsx)("label",{htmlFor:"gameFileInput",children:"Upload Game file"}),(0,v.jsx)("input",{id:"gameFileInput",type:"file",onChange:p}),(0,v.jsx)("hr",{}),(0,v.jsx)("div",{id:"games",children:s.map((e,t)=>(0,v.jsx)(eF,{currentIndex:t,currentgameId:r,onClick:()=>{t!==r&&o(t)},searched:""!==c&&e.gameLog.some(e=>e.chatHistory.some(e=>e.content&&e.content.includes(c)))},t))}),s.length>=1&&(0,v.jsx)("input",{type:"text",className:"inputFinder",value:c,onChange:e=>{d(e.target.value)},placeholder:"text to search"}),(0,v.jsx)("hr",{}),(0,v.jsxs)("div",{id:"gameManager",children:[(0,v.jsx)("input",{className:`${s[r]?"":" disabled"}`,type:"range",min:0,step:1,max:s[r]?s[r].getLength()-1:1,value:i,onChange:e=>{l(parseInt(e.target.value))}}),(0,v.jsxs)("div",{className:"buttonWrapper",children:[(0,v.jsx)("div",{className:`realisticButton previousGame${s[r]&&0!==r?"":" disabled"}`,onMouseDown:()=>{o(e=>e-1)}}),(0,v.jsx)("div",{className:`realisticButton previousStep${s[r]&&0!==i?"":" disabled"}`,onMouseDown:()=>{l(e=>e-1)}}),(0,v.jsx)("div",{className:`realisticButton nextStep${s[r]&&i!==s[r].getLength()-1?"":" disabled"}`,onMouseDown:()=>{l(e=>e+1)}}),(0,v.jsx)("div",{className:`realisticButton nextGame${s[r]&&r!==s.length-1?"":" disabled"}`,onMouseDown:()=>{o(e=>e+1)}})]})]})]})},e$=()=>{let{pointer:e}=em().pointer;return console.log(e),(0,v.jsx)(v.Fragment,{children:e&&(0,v.jsxs)("div",{className:"pointerIndicator",children:[(0,v.jsx)("span",{className:"type",children:e.type}),(0,v.jsxs)("span",{children:["x : ",e.cartesianCoordinate.x]}),(0,v.jsxs)("span",{children:["y : ",e.cartesianCoordinate.y]}),(0,v.jsxs)("span",{children:["z : ",e.cartesianCoordinate.z]})]})})};let eK={[g.MINECRAFT]:{x:1,y:1,z:1},[g.COCOBOTS]:{x:1,y:.3,z:1}},eZ={[g.MINECRAFT]:[z[C.GREEN],z[C.BLUE],z[C.PURPLE],z[C.RED],z[C.ORANGE],z[C.YELLOW]],[g.COCOBOTS]:[z[C.GREEN],z[C.BLUE],z[C.RED],z[C.YELLOW]]},eY={[g.MINECRAFT]:[j.CUBE],[g.COCOBOTS]:[j.NUT,j.WASHER,j.SCREW,j.HORIZONTAL_BRIDGE,j.VERTICAL_BRIDGE]},eJ={[g.MINECRAFT]:{x:{min:-5,max:5},y:{min:1,max:11},z:{min:-5,max:5}},[g.COCOBOTS]:{x:{min:0,max:7},y:{min:1,max:8},z:{min:0,max:7}}},eX=(e,t)=>e.every(e=>e.x>=t.x.min&&e.x<=t.x.max&&e.y>=t.y.min&&e.y<=t.y.max&&e.z>=t.z.min&&e.z<=t.z.max),eq=(e,t)=>1===e.y||t.some(t=>t.x===e.x&&t.y===e.y-1&&t.z===e.z),eQ={[g.MINECRAFT]:(e,t,a)=>{if(!D(t,a)&&eX(t,eJ[g.MINECRAFT]))return e},[g.COCOBOTS]:(e,t,a,s)=>{if(!D(t,a)&&eX(t,eJ[g.COCOBOTS])&&(s||t.every(e=>eq(e,a))))return e}},e0={[g.MINECRAFT]:e=>({worldStates:e.gameLog.map(e=>({timestamp:e.timestamp,chatHistory:e.chatHistory.map(e=>`<${e.user[0]}${e.user.slice(1).toLowerCase()}> ${e.content}`),blocksInGrid:e.shapeInPlace.map(e=>({x:e.position.x,y:e.position.y,z:e.position.z,type:"wool",colour:e.color.id}))}))}),[g.COCOBOTS]:e=>({worldStates:e.gameLog.map(e=>({timestamp:e.timestamp,chatHistory:e.chatHistory.map(e=>`<${e.user[0]}${e.user.slice(1).toLowerCase()}> ${e.content}`),blocksInGrid:e.shapeInPlace.map(e=>({shape:`${Object.values(j)[e.shape][0]}${Object.values(j)[e.shape].slice(1).toLowerCase()}`,position:{x:e.position.x,y:e.position.y,z:e.position.z},color:`${e.color.id[0]}${e.color.id.slice(1).toLowerCase()}`}))}))})},e1={[g.MINECRAFT]:[O.SIMULATION,O.VISUALIZATION,O.NEBULA],[g.COCOBOTS]:[O.SIMULATION,O.VISUALIZATION,O.NEBULA,O.DIRECT_INSTRUCTIONS]},e2={[g.MINECRAFT]:f.FREE,[g.COCOBOTS]:f.UPPER_VIEW},e3={[O.SIMULATION]:N.PLACE,[O.VISUALIZATION]:N.BREAK,[O.NEBULA]:N.BREAK,[O.DIRECT_INSTRUCTIONS]:N.BREAK},e5={[O.SIMULATION]:()=>{let{shapeInPlace:e,environmentMode:{environmentMode:t},gameLog:{gameLog:a},clear:s}=em();return(0,_.useEffect)(()=>{e.pending?document.body.style.cursor="pointer":document.body.style.cursor="auto"},[e]),(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(eR,{}),(0,v.jsx)(eI,{})]}),(0,v.jsxs)(ej,{children:[(0,v.jsx)(eN,{}),(0,v.jsx)(eO,{}),(0,v.jsx)(ef,{}),(0,v.jsx)(ew,{availableUsers:[S.ARCHITECT,S.BUILDER]}),(0,v.jsxs)("div",{id:"gameButtons",children:[(0,v.jsx)("button",{className:"realisticButton",onMouseDown:()=>{let e=new Blob([JSON.stringify(e0[t](a))],{type:"application/json"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download="gameLog.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)},children:(0,v.jsx)(eP,{})}),(0,v.jsx)("button",{className:"realisticButton",onMouseDown:()=>{let e=document.querySelector('canvas[data-engine="three.js r164"]');if(e){let t=e.toDataURL("image/png"),a=document.createElement("a");a.href=t,a.download="canvas-image.png",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("Canvas element not found")},children:(0,v.jsx)(ev,{})}),(0,v.jsx)("button",{className:"realisticButton warning",onMouseDown:s,children:(0,v.jsx)(eB,{})})]})]})]})},[O.VISUALIZATION]:()=>(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(e$,{}),(0,v.jsx)(eR,{}),(0,v.jsx)(eI,{})]}),(0,v.jsxs)(ej,{children:[(0,v.jsx)(eV,{}),(0,v.jsx)(ew,{availableUsers:[]})]})]}),[O.NEBULA]:()=>(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(e$,{}),(0,v.jsx)(eR,{}),(0,v.jsx)(eI,{})]}),(0,v.jsx)(ej,{children:(0,v.jsx)(ew,{availableUsers:[S.ARCHITECT]})})]}),[O.DIRECT_INSTRUCTIONS]:()=>(0,v.jsxs)("main",{children:[(0,v.jsxs)("div",{id:"mainView",children:[(0,v.jsx)(e$,{}),(0,v.jsx)(eR,{}),(0,v.jsx)(eI,{})]}),(0,v.jsx)(ej,{children:(0,v.jsx)(ew,{availableUsers:[S.ARCHITECT]})})]})},e7=.4,e6=new U.Color(11184810);var e4=()=>{let{environmentMode:{environmentMode:e,setEnvironmentMode:t},gameMode:{gameMode:a,setGameMode:s}}=em(),n=(0,eL.useRouter)();return(0,_.useEffect)(()=>{e1[e].includes(a)?n.push("/"+a.toLowerCase()+"/"+e.toLowerCase()):(s(e1[e][0]),n.push("/"+e1[e][0].toLowerCase()+"/"+e.toLowerCase()))},[e,a]),(0,v.jsxs)("header",{children:[(0,v.jsx)("nav",{id:"modeSelector",children:e1[e].map(e=>{let t=O[e];return(0,v.jsx)("div",{onClick:()=>s(t),className:a===t?"selected":"",children:t},t)})}),(0,v.jsxs)("button",{onClick:()=>{let a=Object.keys(g),s=a.indexOf(e);t(a[(s+1)%a.length])},id:"environmentMode",children:[(0,v.jsx)("img",{src:`${n.basePath}${eb[e]}`,alt:"enviromentModeIcon"}),(0,v.jsx)("span",{children:e})]})]})},e9=()=>{let{gameMode:{gameMode:e}}=em(),t=e5[e];return(0,v.jsx)(t,{})},e8=e=>{let{initialEnvironmentMode:t,initialGameMode:a}=e;return(0,v.jsxs)(eu,{initialEnvironmentMode:t,initialGameMode:a,children:[(0,v.jsx)(e4,{}),(0,v.jsx)(e9,{})]})},te=!0,tt=e=>{let{initialGameMode:t,initialEnvironmentMode:a}=e;return(0,v.jsx)("div",{id:"root",children:(0,v.jsx)(e8,{initialEnvironmentMode:a,initialGameMode:t})})};E&&E instanceof Function&&a.e(131).then(a.bind(a,2131)).then(e=>{let{getCLS:t,getFID:a,getFCP:s,getLCP:n,getTTFB:r}=e;t(E),a(E),s(E),n(E),r(E)})}},function(e){e.O(0,[737,447,486,888,774,179],function(){return e(e.s=1492)}),_N_E=e.O()}]);