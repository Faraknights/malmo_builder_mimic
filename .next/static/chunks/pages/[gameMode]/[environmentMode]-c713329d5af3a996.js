(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{1492:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/[gameMode]/[environmentMode]",function(){return a(7742)}])},7742:function(e,t,a){"use strict";a.r(t),a.d(t,{__N_SSG:function(){return eR},default:function(){return ew}});var n,r,i,o,s,l,c,d,h,p,u,m,x,E,g,C,y,I,j=a(5893),O=a(7294);function A(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z}function f(e,t){for(let a of e)for(let e of t)if(A(a,e))return!0;return!1}function P(e,t){let a=(e,t)=>({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z});return Array.isArray(e)?e.map(e=>a(e,t)):a(e,t)}(n=p||(p={})).SIMULATION="SIMULATION",n.VISUALIZATION="VISUALIZATION",n.NEBULA="NEBULA",(r=u||(u={})).MINECRAFT="MINECRAFT",r.COCOBOTS="COCOBOTS";var L=a(9477);(i=m||(m={})).RED="RED",i.BLUE="BLUE",i.GREEN="GREEN",i.ORANGE="ORANGE",i.PURPLE="PURPLE",i.YELLOW="YELLOW",i.WHITE="WHITE",i.BLACK="BLACK",i.NEW="NEW";let N={RED:{hex:"#ff0000",id:"RED"},BLUE:{hex:"#1b4ccd",id:"BLUE"},GREEN:{hex:"#008000",id:"GREEN"},ORANGE:{hex:"#ff6600",id:"ORANGE"},PURPLE:{hex:"#ac00e6",id:"PURPLE"},YELLOW:{hex:"#ffa500",id:"YELLOW"},WHITE:{hex:"#ffffff",id:"WHITE"},BLACK:{hex:"#000000",id:"BLACK"},NEW:{hex:"#deefe1",id:"NEW"}};(o=x||(x={}))[o.CUBE=0]="CUBE",o[o.SCREW=1]="SCREW",o[o.NUT=2]="NUT",o[o.WASHER=3]="WASHER",o[o.HORIZONTAL_BRIDGE=4]="HORIZONTAL_BRIDGE",o[o.VERTICAL_BRIDGE=5]="VERTICAL_BRIDGE",o[o.HORIZONTAL_BRIDGE_COMPONENT=6]="HORIZONTAL_BRIDGE_COMPONENT",o[o.VERTICAL_BRIDGE_COMPONENT=7]="VERTICAL_BRIDGE_COMPONENT";let S=(e,t)=>{let[a,n]=(0,O.useState)(e[0]),[r,i]=(0,O.useState)(e),[o,s]=(0,O.useState)(t[0]),[l,c]=(0,O.useState)(t);return{currentColor:a,colors:r,currentShape:o,shapes:l,setCurrentColor:n,setColors:i,setCurrentShape:s,setShapes:c,changeColor:e=>{n(N[e])}}};var v=a(44);(s=E||(E={})).CELL_BOARD="CELL_BOARD",s.SHAPE="SHAPE",s.SHAPE_FACE="SHAPE_FACE",s.GROUP="GROUP",s.NON_CLICKABLE_FACE="NON_CLICKABLE_FACE",s.SCENE="SCENE",(l=g||(g={})).FRONT="FRONT",l.BACK="BACK",l.TOP="TOP",l.BOTTOM="BOTTOM",l.LEFT="LEFT",l.RIGHT="RIGHT";let T={FRONT:{x:0,y:0,z:1},BACK:{x:0,y:0,z:-1},TOP:{x:0,y:1,z:0},BOTTOM:{x:0,y:-1,z:0},LEFT:{x:1,y:0,z:0},RIGHT:{x:-1,y:0,z:0}},R={[g.FRONT]:{translation:new L.Vector3(0,0,.5),rotation:new L.Euler(0,0,0)},[g.BACK]:{translation:new L.Vector3(0,0,-.5),rotation:new L.Euler(0,Math.PI,0)},[g.TOP]:{translation:new L.Vector3(0,.5,0),rotation:new L.Euler(-Math.PI/2,0,0)},[g.BOTTOM]:{translation:new L.Vector3(0,-.5,0),rotation:new L.Euler(Math.PI/2,0,0)},[g.LEFT]:{translation:new L.Vector3(.5,0,0),rotation:new L.Euler(0,Math.PI/2,0)},[g.RIGHT]:{translation:new L.Vector3(-.5,0,0),rotation:new L.Euler(0,-Math.PI/2,0)}},w=e=>{let t=R[e.facingDirection];return(0,j.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:{type:E.SHAPE_FACE,faceDirection:e.facingDirection},children:[(0,j.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,j.jsx)(v.w,{linewidth:1,threshold:15,color:e.color}),(0,j.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};var M=a(7632);class b{constructor(e,t,a,n){this.nbObjects=()=>{let e=0;for(let t of this.shapes)t instanceof b?e+=t.nbObjects():e++;return e},this.objectExists=(e,t,a)=>{for(let n of this.shapes)if(n instanceof b){if(n.objectExists(e-this.startingPoint.x,t-this.startingPoint.y,a-this.startingPoint.z))return!0}else if(e===n.position.x+this.startingPoint.x&&t===n.position.y+this.startingPoint.y&&a===n.position.z+this.startingPoint.z)return!0;return!1},this.getPositions=()=>this.shapes.flatMap(e=>e instanceof b?e.getPositions():P(G[e.shape],e.position)),this.startingPoint=e,this.shapes=t.map(e=>({...e,breakable:!!n})),this.uuid=(0,M.Z)(),this.pending=a,this.breakable=!!n}}let B=e=>{let{shapeGroup:t}=e;return(0,j.jsx)("mesh",{userData:{type:E.GROUP,position:t.startingPoint,pending:t.pending},children:t.shapes.map((e,a)=>e instanceof b?(0,j.jsx)(B,{shapeGroup:{...e,breakable:t.breakable}},"group-".concat(a)):(0,j.jsx)(F,{...e,breakable:t.breakable},"shape-".concat(a)))})},D={[g.FRONT]:{translation:new L.Vector3(0,0,.5),rotation:new L.Euler(0,0,0),type:E.NON_CLICKABLE_FACE},[g.BACK]:{translation:new L.Vector3(0,0,-.5),rotation:new L.Euler(0,Math.PI,0),type:E.NON_CLICKABLE_FACE},[g.TOP]:{translation:new L.Vector3(0,.5,0),rotation:new L.Euler(-Math.PI/2,0,0),type:E.SHAPE_FACE},[g.BOTTOM]:{translation:new L.Vector3(0,-.5,0),rotation:new L.Euler(Math.PI/2,0,0),type:E.SHAPE_FACE},[g.LEFT]:{translation:new L.Vector3(.5,0,0),rotation:new L.Euler(0,Math.PI/2,0),type:E.NON_CLICKABLE_FACE},[g.RIGHT]:{translation:new L.Vector3(-.5,0,0),rotation:new L.Euler(0,-Math.PI/2,0),type:E.NON_CLICKABLE_FACE}},_=e=>{let t=D[e.facingDirection];return(0,j.jsxs)("mesh",{position:t.translation,rotation:t.rotation,userData:t.type===E.SHAPE_FACE?{type:E.SHAPE_FACE,faceDirection:e.facingDirection}:{type:E.NON_CLICKABLE_FACE},children:[(0,j.jsx)("planeGeometry",{attach:"geometry",args:[1,1]}),1===e.opacity&&(0,j.jsx)(v.w,{linewidth:1,threshold:15,color:e.color}),(0,j.jsx)("meshStandardMaterial",{attach:"material",color:e.color,transparent:1!==e.opacity,opacity:e.opacity})]})};var H=e=>{let{pending:t,color:a,rotation:n}=e,r=new L.Color(a.hex);return(0,j.jsx)("mesh",{scale:["HORIZONTAL"===n?1:.6,1,"HORIZONTAL"===n?.6:1],children:Object.entries(g).map(e=>{let[a,n]=e;return(0,j.jsx)(_,{color:r,opacity:t?eL:1,facingDirection:n},a)})})};let z={[x.CUBE]:e=>{let{pending:t,color:a}=e,n=new L.Color(a.hex);return(0,j.jsx)(j.Fragment,{children:Object.entries(g).map(e=>{let[a,r]=e;return(0,j.jsx)(w,{color:n,opacity:t?eL:1,facingDirection:r},a)})})},[x.SCREW]:function(e){let{pending:t,position:a,color:n}=e,r=new L.LineCurve3(new L.Vector3(0,-.5,0),new L.Vector3(0,.5,0)),i=new L.Color(n.hex),o=t?eL:1,s=(0,j.jsx)("meshStandardMaterial",{attach:"material",color:i,side:L.FrontSide,transparent:1!==o,opacity:o});return(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE},scale:[.65,1,.65],children:[(0,j.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.TOP},children:[(0,j.jsx)("circleGeometry",{args:[.5,25]}),s]}),(0,j.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.BOTTOM},children:[(0,j.jsx)("circleGeometry",{args:[.5,25]}),s]}),(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE,position:a,pending:t},children:[(0,j.jsx)("tubeGeometry",{args:[r,1,.5,25,!1]}),1===o&&(0,j.jsx)(v.w,{linewidth:1,color:i.clone().addScalar(.2)}),s]})]})},[x.NUT]:function(e){let{pending:t,position:a,color:n}=e,r=new L.LineCurve3(new L.Vector3(0,-.5,0),new L.Vector3(0,.5,0)),i=new L.Color(n.hex),o=t?eL:1,s=(0,j.jsx)("meshStandardMaterial",{attach:"material",color:i,side:L.FrontSide,transparent:1!==o,opacity:o});return(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE},scale:[1.1,1,1.1],rotation:[0,-Math.PI/4,0],children:[(0,j.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.TOP},children:[(0,j.jsx)("circleGeometry",{args:[.5,4]}),s]}),(0,j.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.BOTTOM},children:[(0,j.jsx)("circleGeometry",{args:[.5,4]}),s]}),(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE,position:a,pending:t},children:[(0,j.jsx)("tubeGeometry",{args:[r,1,.5,4,!1]}),1===o&&(0,j.jsx)(v.w,{linewidth:1,color:i.clone().addScalar(.2)}),s]})]})},[x.HORIZONTAL_BRIDGE]:e=>{let{color:t,pending:a,position:n,breakable:r}=e,i=new b(n,[{color:t,pending:a,position:{x:0,y:0,z:0},shape:x.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,M.Z)()},{color:t,pending:a,position:{x:1,y:0,z:0},shape:x.HORIZONTAL_BRIDGE_COMPONENT,uuid:(0,M.Z)()}],a,r);return(0,j.jsx)(B,{shapeGroup:i})},[x.VERTICAL_BRIDGE]:e=>{let{color:t,pending:a,position:n,breakable:r}=e,i=new b(n,[{color:t,pending:a,position:{x:0,y:0,z:0},shape:x.VERTICAL_BRIDGE_COMPONENT,uuid:(0,M.Z)()},{color:t,pending:a,position:{x:0,y:0,z:1},shape:x.VERTICAL_BRIDGE_COMPONENT,uuid:(0,M.Z)()}],a,r);return(0,j.jsx)(B,{shapeGroup:i})},[x.WASHER]:function(e){let{pending:t,color:a}=e,n=new L.LineCurve3(new L.Vector3(0,-.5,0),new L.Vector3(0,.5,0)),r=new L.Color(a.hex),i=t?eL:1,o=(0,j.jsx)("meshStandardMaterial",{attach:"material",color:r,side:L.FrontSide,transparent:1!==i,opacity:i});return(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE},scale:[.95,1,.95],children:[(0,j.jsxs)("mesh",{position:[0,.5,0],rotation:[-Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.TOP},children:[(0,j.jsx)("circleGeometry",{args:[.5,4]}),o,1===i&&(0,j.jsx)(v.w,{linewidth:1,color:r.clone().addScalar(.2)})]}),(0,j.jsxs)("mesh",{position:[0,-.5,0],rotation:[Math.PI/2,0,0],userData:{type:E.SHAPE_FACE,faceDirection:g.BOTTOM},children:[(0,j.jsx)("circleGeometry",{args:[.5,4]}),o,1===i&&(0,j.jsx)(v.w,{linewidth:1,color:r.clone().addScalar(.2)})]}),(0,j.jsxs)("mesh",{userData:{type:E.NON_CLICKABLE_FACE},children:[(0,j.jsx)("tubeGeometry",{args:[n,1,.5,4,!1]}),1===i&&(0,j.jsx)(v.w,{linewidth:1,color:r.clone().addScalar(.2)}),o]})]})},[x.HORIZONTAL_BRIDGE_COMPONENT]:e=>(0,j.jsx)(H,{...e,rotation:"HORIZONTAL"}),[x.VERTICAL_BRIDGE_COMPONENT]:e=>(0,j.jsx)(H,{...e,rotation:"VERTICAL"})},G={[x.CUBE]:[{x:0,y:0,z:0}],[x.SCREW]:[{x:0,y:0,z:0}],[x.NUT]:[{x:0,y:0,z:0}],[x.HORIZONTAL_BRIDGE]:[{x:0,y:0,z:0},{x:1,y:0,z:0}],[x.VERTICAL_BRIDGE]:[{x:0,y:0,z:0},{x:0,y:0,z:1}],[x.WASHER]:[{x:0,y:0,z:0}],[x.HORIZONTAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}],[x.VERTICAL_BRIDGE_COMPONENT]:[{x:0,y:0,z:0}]},U=(e,t,a)=>{let n=e=>[parseInt(e.slice(1,3),16),parseInt(e.slice(3,5),16),parseInt(e.slice(5,7),16)],r=n(e),i=n(t);return"#"+r.map((e,t)=>Math.max(0,Math.min(255,Math.round(e+(i[t]-e)*a/100)))).map(e=>e.toString(16).padStart(2,"0")).join("")},F=e=>{let t=z[e.shape];return(0,j.jsx)("mesh",{userData:{type:E.SHAPE,position:e.position,pending:e.pending,shape:e.shape},position:[e.position.x,e.position.y,e.position.z],children:e.breakable&&(0,j.jsx)(t,{...e,color:{hex:U(e.color.hex,N.WHITE.hex,40),id:m.WHITE}})||(0,j.jsx)(t,{...e})})},k=()=>{let[e,t]=(0,O.useState)([]),[a,n]=(0,O.useState)(),r=e=>{t(t=>[...t,e])};return{objects:e,pending:a,setObjects:t,setPending:n,nbObjects:()=>{let t=0;for(let a of e)a instanceof b?t+=a.nbObjects():t++;return t},objectExists:(t,a,n)=>{for(let r of e)if(r instanceof b){if(r.objectExists(t,a,n))return!0}else if(t===r.position.x&&a===r.position.y&&n===r.position.z)return!0;return!1},addObject:r,removeObject:(e,a,n)=>{t(t=>t.filter(t=>{if(t instanceof b){if(t.objectExists(e,a,n))return!1}else if(t.position.x===e&&t.position.y===a&&t.position.z===n)return!1;return!0}))},clear:()=>{t([])},confirmPending:e=>{a&&r(a instanceof b?new b(a.startingPoint,a.shapes,!1,a.breakable):{...a,pending:!1}),n(e)},setBreaking:e=>{let a=e=>e.breakable?e:e instanceof b?new b(e.startingPoint,e.shapes.map(a),e.pending,!0):{...e,breakable:!0};t(t=>t.map(t=>t instanceof b&&A(t.startingPoint,e)?a(t):"position"in t&&A(t.position,e)?a(t):t))},removeBreaking:()=>{let e=t=>t instanceof b?new b(t.startingPoint,t.shapes.map(e),t.pending,!1):{...t,breakable:!1};t(t=>t.map(t=>t.breakable?e(t):t))},getPosition:()=>e.flatMap(e=>e instanceof b?e.getPositions():P(G[e.shape],e.position))}};var W=a(5029),V=a(398),Z=a(2473);let K=e=>{let{position:t}=e;return(0,j.jsxs)("mesh",{userData:{type:E.CELL_BOARD,position:t},rotation:[-Math.PI/2,0,0],position:[t.x,.5,t.z],children:[(0,j.jsx)("planeGeometry",{args:[1,1]}),(0,j.jsx)(v.w,{linewidth:1,threshold:15,color:"black"}),(0,j.jsx)("meshStandardMaterial",{color:[eN.r,eN.g,eN.b],side:L.FrontSide})]})};var Y=e=>{let{environmentMode:t}=e,a=ey[t];return(0,j.jsxs)(j.Fragment,{children:[Array.from({length:a.x.max-a.x.min+1},(e,t)=>a.x.min+t).map(e=>(0,j.jsx)(O.Fragment,{children:Array.from({length:a.z.max-a.z.min+1},(e,t)=>a.z.min+t).map(t=>(0,j.jsx)(K,{position:{x:e,y:0,z:t}},"".concat(e,",").concat(t)))},e)),(0,j.jsx)(Z.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,0],position:[(a.x.max+a.x.min)/2,.5,a.z.min-2],color:"white",anchorX:"center",anchorY:"middle",children:"N"}),(0,j.jsx)(Z.x,{scale:[1,1,1],rotation:[Math.PI/2,0,0],position:[a.x.max+2,.5,(a.z.max+a.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"E"}),(0,j.jsx)(Z.x,{scale:[1,1,1],rotation:[Math.PI/2,0,Math.PI],position:[a.x.min-2,.5,(a.z.max+a.z.min)/2],color:"white",anchorX:"center",anchorY:"middle",children:"W"}),(0,j.jsx)(Z.x,{scale:[1,1,1],rotation:[Math.PI/2,Math.PI,Math.PI],position:[(a.x.max+a.x.min)/2,.5,a.z.max+2],color:"white",anchorX:"center",anchorY:"middle",children:"S"})]})};(c=C||(C={})).PLACE="PLACE",c.BREAK="BREAK";var X=()=>{let[e,t]=(0,O.useState)("PLACE");return{current:e,setCurrent:t}};function J(e){if(e.userData.type===E.SHAPE||e.userData.type!==E.NON_CLICKABLE_FACE&&e.userData.type!==E.SHAPE_FACE)return e;{let t=e;for(;t.userData.type!==E.SHAPE;)t.parent&&(t=t.parent);return t}}function $(e){let t={x:0,y:0,z:0};e.userData.type===E.SHAPE?t=P(t,e.userData.position):e.userData.type===E.GROUP&&(t=P(t,e.userData.position));let a=e.parent;return a.userData.type===E.GROUP?P(t,$(a)):t}var q=e=>{let{shapeInPlace:t,gameMode:a,inventory:n,action:r,environmentMode:i}=e,{objects:o,pending:s}=t,[l,c]=(0,O.useState)(null),d=(e,a,r)=>{let o={uuid:(0,M.Z)(),pending:!0,breakable:!1,color:n.currentColor,position:e,shape:a};return eO[i](o,P(G[o.shape],o.position),t.getPosition(),r)},h=e=>{let a=e.intersections[0].object,r=J(a);if(a.userData.type===E.SHAPE_FACE){let e=a.userData,i=P($(r),T[e.faceDirection]);t.confirmPending(d(i,n.currentShape,!0))}else t.confirmPending();e.stopPropagation()},u=e=>{if(e.intersections[0]){let n=J(e.intersections[0].object);if(n.userData.type===E.SHAPE){for(var a;(null===(a=n.parent)||void 0===a?void 0:a.userData.type)===E.GROUP;)n=n.parent;let e=$(n);t.removeObject(e.x,e.y,e.z)}x(e.intersections.slice(1))}e.stopPropagation()},m=e=>{if(e[0]){let a=e[0].object;if(a.userData.type===E.CELL_BOARD){let e=a.userData,r=t.pending,i={...e.position,y:e.position.y+1};r&&A(r instanceof b?r.startingPoint:r.position,i)||t.setPending(d(i,n.currentShape))}else if(a.userData.type===E.SHAPE_FACE){let e=a.userData,r=J(a);if(!(null==r?void 0:r.userData).pending){let a=t.pending,i=P($(r),T[e.faceDirection]);a&&f([a instanceof b?a.startingPoint:a.position],[i])||t.setPending(d(i,n.currentShape))}}else t.setPending(void 0)}},x=e=>{if(e[0]){t.removeBreaking();let n=J(e[0].object);if(n.userData.type===E.SHAPE){for(var a;(null===(a=n.parent)||void 0===a?void 0:a.userData.type)===E.GROUP;)n=n.parent;let e=$(n);t.setBreaking(e)}}},g=(0,O.useMemo)(()=>o.map(e=>e instanceof b?(0,j.jsx)(B,{shapeGroup:{...e}},e.uuid):(0,j.jsx)(F,{...e},e.uuid)),[o]),y=(0,O.useMemo)(()=>s&&a===p.SIMULATION&&(s instanceof b?(0,j.jsx)(B,{shapeGroup:s},s.uuid):(0,j.jsx)(F,{...s},s.uuid)),[s,a]);return(0,j.jsxs)("mesh",{...a===p.SIMULATION?{onPointerDown:e=>c({x:e.clientX,y:e.clientY}),onPointerMove:e=>{let t=e.intersections.filter(e=>{let t=J(e.object);return t.userData.type!==E.SHAPE||!t.userData.pending});(null==r?void 0:r.current)===C.PLACE?m(t):x(t)},onPointerOut:e=>{0===e.intersections.length&&(t.setPending(void 0),t.removeBreaking())},onPointerUp:e=>{if(l){let a=Math.abs(e.clientX-l.x),n=Math.abs(e.clientY-l.y);a<5&&n<5&&((null==r?void 0:r.current)===C.PLACE?t.pending&&h(e):(null==r?void 0:r.current)===C.BREAK&&u(e))}c(null)}}:{},scale:[eE[i].x,eE[i].y,eE[i].z],userData:{type:E.SCENE},children:[(0,j.jsx)(Y,{environmentMode:i},i),g,y]})};(d=y||(y={})).FREE="Free camera",d.SIDE_VIEW="Side view",d.UPPER_VIEW="Upper view";let Q={"Free camera":{orthographic:!1,polarAngle:{max:Math.PI,min:0},cameraSettings:{fov:75,aspect:window.innerWidth/window.innerHeight,near:.1,far:1e3,position:[0,5,10]}},"Side view":{orthographic:!0,polarAngle:{max:Math.PI/2,min:Math.PI/2},cameraSettings:{zoom:50,position:[100,5,10]}},"Upper view":{orthographic:!0,polarAngle:{max:0,min:0},cameraSettings:{zoom:50,position:[0,5,10]},azimuthAngle:{max:0,min:0}}};var ee=()=>{let[e,t]=(0,O.useState)("Free camera");return{current:e,setCurrent:t}};let et=e=>{let{shapeInPlace:t,gameMode:a,environmentMode:n,inventory:r,action:i}=e,o=ey[n];return(0,j.jsx)("mesh",{position:[-(o.x.max+o.x.min)/2,1,-(o.z.max+o.z.min)/2],children:(0,j.jsx)(q,{shapeInPlace:t,gameMode:a,inventory:r,action:i,environmentMode:n})})};var ea=e=>{var t,a;let n=new L.Color(1710878),r=(0,O.useMemo)(()=>(0,j.jsx)(et,{...e}),[e]);return(0,j.jsxs)(W.Xz,{gl:{preserveDrawingBuffer:!0},frameloop:"demand",orthographic:Q[e.camera].orthographic,camera:Q[e.camera].cameraSettings,children:[r,(0,j.jsx)(V.z,{enablePan:!1,minPolarAngle:Q[e.camera].polarAngle.min,maxPolarAngle:Q[e.camera].polarAngle.max,minAzimuthAngle:null===(t=Q[e.camera].azimuthAngle)||void 0===t?void 0:t.min,maxAzimuthAngle:null===(a=Q[e.camera].azimuthAngle)||void 0===a?void 0:a.max}),(0,j.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,j.jsx)("ambientLight",{intensity:1}),(0,j.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200}),(0,j.jsx)("color",{attach:"background",args:[n.r,n.g,n.b]})]},e.camera)},en=e=>{let{children:t}=e;return(0,j.jsx)("div",{id:"side",children:t})},er=e=>{let{currentColor:t,colors:a,changeColor:n}=e,r=[];for(let e=0;e<a.length;e+=3)r.push(a.slice(e,e+3));return(0,j.jsxs)("div",{id:"colorPicker",className:"module",children:[(0,j.jsx)("h3",{children:"Color Picker"}),(0,j.jsx)("div",{id:"colorList",children:r.map((e,a)=>(0,j.jsx)("div",{children:e.map(e=>(0,j.jsxs)("div",{className:"color".concat(t.id===e.id?" selected":""),onClick:()=>n(e.id),children:[(0,j.jsx)("div",{style:{backgroundColor:e.hex}}),(0,j.jsx)("span",{children:e.id[0]+e.id.slice(1).toLowerCase()})]},e.id))},a))})]})},ei=e=>{let{current:t,setCurrent:a}=e;return(0,j.jsxs)("div",{id:"actionSelector",className:"module",children:[(0,j.jsx)("h3",{children:"Action:"}),(0,j.jsx)("div",{className:"buttonsWrapper",children:Object.values(C).map(e=>(0,j.jsx)("button",{className:"".concat(e).concat(t===e?" selected":""),onClick:()=>a(e),children:e[0]+e.slice(1).toLowerCase()},e))})]})},eo=e=>{let{inventory:{currentColor:t,currentShape:a,shapes:n,setCurrentShape:r},environmentMode:i}=e,o=[];for(let e=0;e<n.length;e+=2)o.push(n.slice(e,e+2));return n.length>1&&(0,j.jsxs)("div",{id:"shapePicker",className:"module",children:[(0,j.jsx)("h3",{children:"Shape Picker"}),(0,j.jsx)("div",{id:"colorList",children:o.map((e,n)=>(0,j.jsx)("div",{children:e.map(e=>{let n=G[e],o=n.map(e=>e.x),s=n.map(e=>e.z);return(0,j.jsxs)("div",{className:"color".concat(a===e?" selected":""),onClick:()=>r(e),children:[(0,j.jsxs)(W.Xz,{frameloop:"demand",camera:{position:[0,2,0],far:1e3},children:[(0,j.jsx)("mesh",{scale:[eE[i].x,eE[i].y,eE[i].z],position:[-((Math.max(...o)-Math.min(...o))/2),0,-((Math.max(...s)-Math.min(...s))/2)],children:(0,j.jsx)(F,{breakable:!1,pending:!1,color:t,position:{x:0,y:0,z:0},shape:e,uuid:x[e]})}),(0,j.jsx)(V.z,{}),(0,j.jsx)("fog",{attach:"fog",args:["white",20,1e3]}),(0,j.jsx)("ambientLight",{intensity:1}),(0,j.jsx)("pointLight",{color:"white",position:[3,10,3],intensity:200})]}),(0,j.jsx)("span",{children:x[e][0]+x[e].slice(1).toLowerCase().replace("_"," ")})]},e)})},n))})]})||(0,j.jsx)(j.Fragment,{})};let es=()=>{let[e,t]=(0,O.useState)([]);return{chatHistory:e,setChatHistory:t,addMessage:e=>{e.content&&t(t=>[...t,e])},clear:()=>{t([])}}};var el=a(1375),ec=a(5774);class ed{getLength(){return this.gameLog.length}addWorldState(e){this.gameLog.push(e)}clear(){this.gameLog=[]}getLastWorldState(){let e=this.gameLog[this.gameLog.length-1];return e?e.timestamp?{timestamp:e.timestamp,chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:{chatHistory:[...e.chatHistory],shapeInPlace:[...e.shapeInPlace]}:void 0}getWorldStateById(e){if(e<this.gameLog.length){let t=this.gameLog[e];return t.timestamp?{timestamp:t.timestamp,chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}:{chatHistory:[...t.chatHistory],shapeInPlace:[...t.shapeInPlace]}}}constructor(){this.gameLog=[{chatHistory:[],shapeInPlace:[],timestamp:new Date}]}}function eh(e,t){let a=e.trim(),n=t.getLastWorldState();if(a.startsWith("place")){let e=a.split(" ");null==n||n.shapeInPlace.push({pending:!1,breakable:!1,uuid:(0,M.Z)(),color:N[e[1].toUpperCase()],position:{x:parseInt(e[2]),y:parseInt(e[3]),z:parseInt(e[4])},shape:x.CUBE})}else if(a.startsWith("pick")){let e=a.split(" "),t={x:parseInt(e[1]),y:parseInt(e[2]),z:parseInt(e[3])};n.shapeInPlace=n.shapeInPlace.filter(e=>e.position.x!==t.x||e.position.y!==t.y||e.position.z!==t.z)}else{let e=a.split(/<(.*)> (.*)/);null==n||n.chatHistory.push({user:e[1],content:e[2]})}t.addWorldState(n)}(h=I||(I={})).SYSTEM="SYSTEM",h.ARCHITECT="ARCHITECT",h.BUILDER="BUILDER ",h.NEBULA="NEBULA";var ep=e=>{let{chat:t,availableUsers:a,nebula:n,shapeInPlace:r}=e,i=(0,O.useRef)(null);(0,O.useEffect)(()=>{i.current&&(i.current.scrollTop=i.current.scrollHeight)},[t.chatHistory]);let[o,s]=(0,O.useState)("ARCHITECT"),[l,c]=(0,O.useState)(!1);return(0,j.jsxs)("div",{id:"chat",className:"module",children:[(0,j.jsx)("h3",{children:"Chat"}),(0,j.jsx)("hr",{}),(0,j.jsx)("div",{ref:i,children:t.chatHistory.map((e,a)=>(0,j.jsxs)("div",{children:[(0===a||e.user!==t.chatHistory[a-1].user)&&(0,j.jsx)("span",{className:"userName",children:e.user},"user-".concat(a)),(0,j.jsx)("div",{className:"message",children:e.content},a)]},a))}),a.length>=1&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("hr",{}),(0,j.jsxs)("div",{children:[(0,j.jsx)("button",{onClick:()=>{s(a[(a.findIndex(e=>e===o)+1)%a.length])},children:o}),(0,j.jsx)("input",{type:"text",className:l?"disable":"",disabled:l,onKeyDown:e=>{if("Enter"===e.key){let a=e.currentTarget.value;t.addMessage({content:a,user:o}),n&&(async()=>{await (0,el.L)("/api/new_message2",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:a}),onmessage:async e=>{if(e.data){let a="";a=(0,ec.Z)(e.data)?atob(e.data):e.data;try{let e=JSON.parse(a);if(console.log(e),"WAIT"===e.type)t.addMessage({content:e.content,user:"SYSTEM"}),c(!0);else if("MESSAGE"===e.type){if(/^((place|pick) .* [0-9]* [0-9]* [0-9]*\n?)*$/.test(e.content)){let t=e.content.trim().split("\n"),a=new ed;t.forEach(e=>{eh(e.trim(),a)}),async function(e){for(let t=1;t<e.gameLog.length;t++){let a=e.gameLog[t];r.addObject(a.shapeInPlace[a.shapeInPlace.length-1]),await new Promise(e=>setTimeout(e,500))}}(a),console.log(a)}else t.addMessage({content:e.content,user:"NEBULA"})}else"RESUME"===e.type&&c(!1)}catch(e){console.error("Failed to parse JSON:",e)}}}})})(),e.currentTarget.value=""}}})]})]})]})},eu=e=>{let{current:t,setCurrent:a}=e;return(0,j.jsx)("div",{id:"cameraSelector",className:"module",children:Object.values(y).map(e=>(0,j.jsx)("button",{className:"".concat(e).concat(t===e?" selected":""),onClick:()=>a(e),children:e[0]+e.slice(1).toLowerCase()},e))})};let em=O.memo(e=>{var t,a;let{gameLog:n,currentIndex:r,currentgameId:i,onClick:o,searched:s}=e;return(0,j.jsxs)("div",{className:"game ".concat(r===i?"selected":""," ").concat(s?"searched":""),onClick:o,children:[!(null===(t=n.getWorldStateById(0))||void 0===t?void 0:t.chatHistory.length)&&!(null===(a=n.getWorldStateById(0))||void 0===a?void 0:a.shapeInPlace.length)&&(0,j.jsx)("div",{className:"new"})||(0,j.jsx)("div",{className:"old"}),(0,j.jsxs)("span",{children:["Game ",r]})]})});em.displayName="GameComponent";var ex=e=>{let{chatHistory:t,shapeInPlace:a}=e,[n,r]=(0,O.useState)([]),[i,o]=(0,O.useState)(0),[s,l]=(0,O.useState)(0),[c,d]=(0,O.useState)("");(0,O.useEffect)(()=>{var e;l(null===(e=n[i])||void 0===e?void 0:e.gameLog.reduce((e,t,a,n)=>{var r,i;return t.chatHistory.length!==(null!==(i=null===(r=n[a-1])||void 0===r?void 0:r.chatHistory.length)&&void 0!==i?i:0)?a:e},0))},[i]),(0,O.useEffect)(()=>{if(n[i]){let e=n[i].getWorldStateById(s);e&&(a.setObjects(e.shapeInPlace),t.setChatHistory(e.chatHistory))}},[i,s]);let h=async e=>{let t=e.target.files&&e.target.files[0];if(console.log("1"),t){var a;let e=null===(a=t.name.split(".").pop())||void 0===a?void 0:a.toLowerCase();console.log("2");try{if("csv"===e){console.log("3");let e=new FileReader;e.onload=e=>{var t;console.log("csv");let a=null===(t=e.target)||void 0===t?void 0:t.result,n=function(e){try{let t;let a=[],n=/"(.+?)","?(.*?)"?(?=(\n"|$))/gs,r=/((?:^(?:(?:place|pick) .*?\n)*|EMPTY))(.*?)(<.*)/s;for(;null!==(t=n.exec(e));){let[e,n]=[t[1],t[2]],i=e.match(r),o=i[2].trim().replace(/^"+|"+$/g,""),s=i[3].trim().split("\n"),l={chatHistory:[],shapeInPlace:[]};(function(e,t){"EMPTY"!==e&&e&&e.split(":").forEach(e=>{let a=e.match(/(\d+) (\w+) (.*)/);if(a){let[,,e,n]=a;n.split(",").forEach(a=>{let[n,r,i]=a.trim().split(" "),o=N[e.toUpperCase()];t.shapeInPlace.push({pending:!1,breakable:!1,uuid:(0,M.Z)(),color:o,shape:x.CUBE,position:{x:parseInt(n),y:parseInt(r),z:parseInt(i)}})})}})})(o,l);let c=new ed;c.addWorldState(l),s.forEach(e=>{eh(e.trim(),c)}),n.split("\n").forEach(e=>{eh(e.trim(),c)}),a.push(c)}return a}catch(e){throw Error("Error parsing CSV: ".concat(e.message))}}(a);r(e=>[...e,...n])},e.readAsText(t)}else if("json"===e){let e=await new Promise((e,a)=>{let n=new FileReader;n.onload=t=>{try{var n;let{worldStates:a}={worldStates:JSON.parse(null===(n=t.target)||void 0===n?void 0:n.result)},r={chatHistory:[],shapeInPlace:[],timestamp:new Date},i=[],o=new ed;a.forEach(e=>{r.shapeInPlace.push({color:N[m[e.color.toUpperCase()]],breakable:!1,pending:!1,position:{x:e.x,y:e.y,z:e.z},shape:x.CUBE,uuid:(0,M.Z)()});let t=JSON.parse(JSON.stringify(r));o.addWorldState(t)}),i.push(o),e(i)}catch(e){a(e)}},n.onerror=e=>{var t;a((null===(t=e.target)||void 0===t?void 0:t.error)||Error("Unknown FileReader error"))},n.readAsText(t)});r(t=>[...t,...e])}else console.error("Unsupported file type:",e)}catch(e){console.error("Error processing file:",e)}}};return(0,j.jsxs)("div",{id:"fileManager",className:"module",children:[(0,j.jsx)("label",{htmlFor:"gameFileInput",children:"Upload Game file"}),(0,j.jsx)("input",{id:"gameFileInput",type:"file",onChange:h}),(0,j.jsx)("hr",{}),(0,j.jsx)("div",{id:"games",children:n.map((e,t)=>(0,j.jsx)(em,{gameLog:e,currentIndex:t,currentgameId:i,onClick:()=>{t!==i&&o(t)},searched:""!==c&&e.gameLog.some(e=>e.chatHistory.some(e=>e.content&&e.content.includes(c)))},t))}),n.length>=1&&(0,j.jsx)("input",{type:"text",className:"inputFinder",value:c,onChange:e=>{d(e.target.value)},placeholder:"text to search"}),(0,j.jsx)("hr",{}),(0,j.jsxs)("div",{id:"gameManager",className:n[i]?"":"disabled",children:[(0,j.jsx)("input",{type:"range",min:0,step:1,max:n[i]?n[i].getLength()-1:1,value:s,onChange:e=>{l(parseInt(e.target.value))}}),(0,j.jsxs)("div",{className:"buttonWrapper",children:[(0,j.jsx)("div",{className:"previousGame".concat(n[i]&&0===i?" disabled":""),onClick:()=>{o(e=>e-1)}}),(0,j.jsx)("div",{className:"previousStep".concat(n[i]&&0===s?" disabled":""),onClick:()=>{l(e=>e-1)}}),(0,j.jsx)("div",{className:"nextStep".concat(n[i]&&s===n[i].getLength()-1?" disabled":""),onClick:()=>{l(e=>e+1),console.log(n)}}),(0,j.jsx)("div",{className:"nextGame".concat(n[i]&&i===n.length-1?" disabled":""),onClick:()=>{o(e=>e+1)}})]})]})]})};let eE={[u.MINECRAFT]:{x:1,y:1,z:1},[u.COCOBOTS]:{x:1,y:.3,z:1}},eg={[u.MINECRAFT]:[N[m.GREEN],N[m.BLUE],N[m.PURPLE],N[m.RED],N[m.ORANGE],N[m.YELLOW]],[u.COCOBOTS]:[N[m.GREEN],N[m.BLUE],N[m.RED],N[m.YELLOW],N[m.NEW]]},eC={[u.MINECRAFT]:[x.CUBE],[u.COCOBOTS]:[x.NUT,x.WASHER,x.SCREW,x.HORIZONTAL_BRIDGE,x.VERTICAL_BRIDGE]},ey={[u.MINECRAFT]:{x:{min:-5,max:5},y:{min:1,max:11},z:{min:-5,max:5}},[u.COCOBOTS]:{x:{min:0,max:7},y:{min:1,max:11},z:{min:0,max:7}}},eI=(e,t)=>e.every(e=>e.x>=t.x.min&&e.x<=t.x.max&&e.y>=t.y.min&&e.y<=t.y.max&&e.z>=t.z.min&&e.z<=t.z.max),ej=(e,t)=>1===e.y||t.some(t=>t.x===e.x&&t.y===e.y-1&&t.z===e.z),eO={[u.MINECRAFT]:(e,t,a)=>{if(!f(t,a)&&eI(t,ey[u.MINECRAFT]))return e},[u.COCOBOTS]:(e,t,a,n)=>{if(!f(t,a)&&eI(t,ey[u.COCOBOTS])&&(n||t.every(e=>ej(e,a))))return e}},eA={[u.MINECRAFT]:e=>({WorldStates:e.gameLog.map(e=>({Timestamp:e.timestamp,ChatHistory:e.chatHistory.map(e=>"<".concat(e.user[0]).concat(e.user.slice(1).toLowerCase(),"> ").concat(e.content)),BlocksInGrid:e.shapeInPlace.map(e=>({X:e.position.x,Y:e.position.y,Z:e.position.z,Type:"wool",Colour:e.color.id}))}))}),[u.COCOBOTS]:e=>({worldStates:e.gameLog.map(e=>({timestamp:e.timestamp,chatHistory:e.chatHistory.map(e=>"<".concat(e.user[0]).concat(e.user.slice(1).toLowerCase(),"> ").concat(e.content)),blocksInGrid:e.shapeInPlace.map(e=>({shape:"".concat(Object.values(x)[e.shape][0]).concat(Object.values(x)[e.shape].slice(1).toLowerCase()),position:{x:e.position.x,y:e.position.y,z:e.position.z},color:"".concat(e.color.id[0]).concat(e.color.id.slice(1).toLowerCase())}))}))})},ef={[u.MINECRAFT]:[p.SIMULATION,p.VISUALIZATION],[u.COCOBOTS]:[p.SIMULATION,p.NEBULA]},eP={[p.SIMULATION]:e=>{let{environmentMode:t}=e,a=S(eg[t],eC[t]),n=k(),r=X(),i=ee(),o=es(),[s,l]=(0,O.useState)(new ed);return(0,O.useEffect)(()=>{n.pending?document.body.style.cursor="pointer":document.body.style.cursor="auto"},[n]),(0,O.useEffect)(()=>{n.setObjects([]),a.setColors(eg[t]),a.setCurrentColor(eg[t][0]),a.setShapes(eC[t]),a.setCurrentShape(eC[t][0]),l(new ed),o.setChatHistory([])},[t]),(0,O.useEffect)(()=>{let e=s.getLastWorldState();e?(n.objects.length!==e.shapeInPlace.length||o.chatHistory.length!==e.chatHistory.length)&&(s.addWorldState({timestamp:new Date,chatHistory:[...o.chatHistory],shapeInPlace:[...n.objects]}),l(s)):(0!==n.objects.length||0!==o.chatHistory.length)&&(s.addWorldState({timestamp:new Date,chatHistory:[...o.chatHistory],shapeInPlace:[...n.objects]}),l(s))},[n.objects,o.chatHistory]),(0,j.jsxs)("main",{children:[(0,j.jsxs)("div",{id:"mainView",children:[(0,j.jsx)(eu,{...i}),(0,j.jsx)(ea,{gameMode:p.SIMULATION,shapeInPlace:n,inventory:a,action:r,camera:i.current,environmentMode:t})]}),(0,j.jsxs)(en,{children:[(0,j.jsx)(ei,{...r}),(0,j.jsx)(er,{...a}),(0,j.jsx)(eo,{inventory:a,environmentMode:t}),(0,j.jsx)(ep,{chat:o,availableUsers:[I.ARCHITECT,I.BUILDER],shapeInPlace:n}),(0,j.jsxs)("div",{id:"gameButtons",children:[(0,j.jsx)("button",{id:"download",onClick:()=>{let e=new Blob([JSON.stringify(eA[t](s))],{type:"application/json"}),a=URL.createObjectURL(e),n=document.createElement("a");n.href=a,n.download="gameLog.json",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)},children:"Download json"}),(0,j.jsx)("button",{id:"download",onClick:()=>{let e=document.querySelector('canvas[data-engine="three.js r164"]');if(e){let t=e.toDataURL("image/png"),a=document.createElement("a");a.href=t,a.download="canvas-image.png",document.body.appendChild(a),a.click(),document.body.removeChild(a)}else console.error("Canvas element not found")},children:"Download png"}),(0,j.jsx)("button",{id:"reset",onClick:()=>{n.clear(),o.clear()},children:"Clear Board"})]})]})]})},[p.VISUALIZATION]:e=>{let{environmentMode:t}=e,a=es(),n=k();return(0,j.jsxs)("main",{children:[(0,j.jsx)(ea,{environmentMode:t,shapeInPlace:{...n},gameMode:p.VISUALIZATION,camera:y.FREE}),(0,j.jsxs)(en,{children:[(0,j.jsx)(ex,{chatHistory:a,shapeInPlace:n}),(0,j.jsx)(ep,{chat:a,availableUsers:[],shapeInPlace:n})]})]})},[p.NEBULA]:e=>{let{environmentMode:t}=e,a=S(eg[t],eC[t]),n=k(),r=X(),i=ee(),o=es();return(0,j.jsxs)("main",{children:[(0,j.jsx)("div",{id:"mainView",children:(0,j.jsx)(ea,{gameMode:p.NEBULA,shapeInPlace:n,inventory:a,action:r,camera:i.current,environmentMode:t})}),(0,j.jsx)(en,{children:(0,j.jsx)(ep,{chat:o,availableUsers:[I.ARCHITECT],shapeInPlace:n,nebula:!0})})]})}},eL=.4,eN=new L.Color(11184810);var eS=a(1163),ev=e=>{let{currentGameMode:t,setGameMode:a,environmentMode:n,setEnvironmentMode:r}=e,i=(0,eS.useRouter)();return(0,O.useEffect)(()=>{ef[n].includes(t)?i.push("/"+t.toLowerCase()+"/"+n.toLowerCase()):(a(ef[n][0]),i.push("/"+ef[n][0].toLowerCase()+"/"+n.toLowerCase()))},[n,t]),(0,j.jsxs)("header",{children:[(0,j.jsx)("nav",{id:"modeSelector",children:ef[n].map(e=>{let n=p[e];return(0,j.jsx)("div",{onClick:()=>a(n),className:t===n?"selected":"",children:n},n)})}),(0,j.jsx)("button",{onClick:()=>{let e=Object.keys(u),t=e.indexOf(n);r(e[(t+1)%e.length])},id:"environmentMode",children:n})]})},eT=e=>{let{initialEnvironmentMode:t,initialGameMode:a}=e,[n,r]=(0,O.useState)(t),[i,o]=(0,O.useState)(a),s=eP[i];return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ev,{currentGameMode:i,setGameMode:o,environmentMode:n,setEnvironmentMode:r}),(0,j.jsx)(s,{environmentMode:n})]})},eR=!0,ew=e=>{let{initialGameMode:t,initialEnvironmentMode:a}=e;return(0,j.jsx)("div",{id:"root",children:(0,j.jsx)(eT,{initialEnvironmentMode:a,initialGameMode:t})})}},5774:function(e,t,a){"use strict";function n(e){if("string"!=typeof e)return!1;0===e.indexOf("data:")&&(e=e.split(",")[1]);try{return btoa(atob(e))===e}catch(e){return!1}}a.d(t,{Z:function(){return n}})}},function(e){e.O(0,[737,927,888,774,179],function(){return e(e.s=1492)}),_N_E=e.O()}]);